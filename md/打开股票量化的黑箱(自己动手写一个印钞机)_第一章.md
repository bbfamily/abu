
# æ‰“å¼€è‚¡ç¥¨é‡åŒ–çš„é»‘ç®±(è‡ªå·±åŠ¨æ‰‹å†™ä¸€ä¸ªå°é’æœº) ç¬¬ä¸€ç« 

### ä½œè€…ï¼šé˜¿å¸ƒğŸ¶

### æœªç»æœ¬äººå…è®¸ç¦æ­¢è½¬è½½
___
### å‰è¨€ï¼š


### æœ¬æ–‡ä½¿ç”¨pythonæ¥åšè‚¡ç¥¨é‡åŒ–åˆ†æï¼Œæ¶‰åŠæ•°æ®æŒ–æ˜åˆ†æä¸æœºå™¨å­¦ä¹ æ–¹é¢çŸ¥è¯†ï¼Œè‚¡ç¥¨çŸ¥è¯†æ¶‰åŠçš„ä¸å¤šï¼Œæœ¬æ–‡æ¶‰åŠçš„ç­–ç•¥éƒ½åªæ˜¯è€ƒè™‘å•è¾¹åšå¤šä¸æ¶‰åŠåšç©ºã€‚

### å…³äºé‡åŒ–çš„å®šä¹‰æˆ‘ä¸æƒ³ä»ä¹‹å‰æŸæœ¬çœ‹è¿‡çš„ä¹¦æˆ–è€…ç½‘ç»œæ‰¾æ¥ä¸€æ®µå†™ä¸Šï¼Œäº‹å®ä¸Šå†™è¿™æ•´ç¯‡æ–‡ç« æˆ‘éƒ½å°½é‡é¿å…è‡ªå·±ä»ä»»ä½•ä¹‹å‰çœ‹è¿‡çš„ä¸œè¥¿æ‰¾æ¥å®šä¹‰æˆ–è€…è§£é‡Šï¼Œæˆ‘å°½é‡ä½¿ç”¨å¤§ç™½è¯æ¥è¯´æ˜ä¸€åˆ‡ï¼Œä½†æ˜¯ç”±äºè‚¡ç¥¨é‡åŒ–æœ¬èº«æ˜¯ä¸ªå¤ªåºå¤§ï¼Œç»†èŠ‚éå¸¸å¤šï¼ŒçŸ¥è¯†ä½“ç³»ä¹Ÿéå¸¸å¤æ‚çš„ç³»ç»Ÿï¼Œæ‰€ä»¥ä¸€å®šä¼šæœ‰æ¨å¤šåœ°æ–¹æˆ‘å°†è¯´ä¸æ¸…æ¥šï¼Œå¯ä»¥è”ç³»æˆ‘ï¼Œä¸€èµ·æ¢è®¨ï¼Œå›åˆ°é‡åŒ–å®šä¹‰æˆ‘çš„ç†è§£ï¼šé€šè¿‡å¯¹æ•°æ®è¿›è¡Œå„ç§å˜æ¢ï¼Œåˆ†æè‚¡ç¥¨æ—¶é—´åºåˆ—æ•°æ®ï¼Œæ‰¾åˆ°ç›¸å¯¹èµ¢çš„æ¦‚ç‡å¤§çš„ç‰¹å¾ï¼ŒæŠ½å–ç‰¹å¾ç»„æˆè§„åˆ™ï¼Œä½¿ç”¨è¿™ä¸ªè§„åˆ™æŒ‡å¯¼äº¤æ˜“ï¼Œå…¶å®æˆ‘æƒ³è¯´çš„å°±æ˜¯æ‰¾åˆ°ä¸€ä¸ªæ–¹æ³•ç‚’è‚¡ç„¶ååªèµšä¸èµ”ï¼Œå“ˆå“ˆï¼Œæˆ‘ä¸‹é¢ä¼šä¸€æ­¥ä¸€æ­¥è®²è§£åˆ°åº•å¦‚ä½•åšå‡ºè¿™æ ·çš„ä¸€ä¸ªå°é’æœºï¼ˆçœ‹åˆ°è¿™ä¸ªè¯æˆ‘å°±é«˜å…´ğŸ˜Šï¼‰å†æ¬¡å¼ºè°ƒç”±äºæˆ‘æ— æ³•è§£é‡Šæ‰€æœ‰ç»†èŠ‚ï¼Œå¹¶ä¸”çŸ¥è¯†ä½“ç³»ä¹Ÿç¡®å®éœ€è¦å¾ˆå¤šï¼Œæˆ‘ä¸èƒ½ä¿è¯ä½ èƒ½å…¨éƒ¨çœ‹æ‡‚æˆ‘ä¸‹é¢å†å†™ä¸€äº›ä»€ä¹ˆï¼Œè¿˜æ˜¯å“ªå¥è¯ï¼Œæˆ‘ä¼šç•™ä¸‹å¾®ä¿¡ï¼Œå¦‚æœ‰é—®é¢˜ï¼Œå¯ä»¥è”ç³»æˆ‘ä¸€èµ·æ¢è®¨ï¼ˆæ–‡ç« æœ€åæœ‰å¾®ä¿¡å·ï¼Œå¦‚æœèƒ½çœ‹åˆ°å“ªé‡Œå†è¯´å§ï¼‰ã€‚

____
# éå‡è¡¡èƒœè´Ÿæ”¶ç›Šå¸¦æ¥çš„å¿…ç„¶éå‡è¡¡èƒœè´Ÿæ¯”ä¾‹ï¼Œç›®æ ‡ç”±å› å­çš„èƒ½åŠ›è§£å†³ä¸€éƒ¨åˆ†ï¼Œæ¨¡å¼è¯†åˆ«æå‡å…³é”®çš„ä¸€éƒ¨åˆ†

**è¿™ä¸ªå°±æ˜¯è¿™ç¯‡æ–‡ç« æ ¸å¿ƒçš„æ€æƒ³ï¼ŒåŸåˆ›ï¼Œè¿™ä¸€ç« å¼€ä¸ä¼šæ¶‰åŠï¼Œä»ä¸‹ä¸€ç« å¼€å§‹ï¼Œå…¶å®æ•´ä¸ªæ–‡ç« æˆ‘åªæ˜¯æƒ³è§£é‡Šè¿™å¥è¯ï¼Œå‰é¢è¦åšä¸€äº›å¿…è¦é“ºå«ï¼Œå¦‚æœä½ æœ‰æ¯”è¾ƒå¤šçš„è‚¡ç¥¨é‡åŒ–çŸ¥è¯†è¯·å¿½ç•¥å‰é¢çš„ç« èŠ‚ï¼Œç›´æ¥è·³åˆ°æ ¸å¿ƒç« èŠ‚ï¼Œæˆ–è€…ä½ ä¹Ÿå¯ä»¥é€‰æ‹©è·³è·ƒé˜…è¯»ï¼Œä»ç¬¬äºŒç« å¼€å§‹æ•´ä¸ªå°é’æœºä¹‹æ—…**

___
## ä¸€. å‰å¥å¼€å§‹
 
### 1. æ•°æ®ç³»ç»Ÿ 

#### çˆ¬å–æˆ–è€…è´­ä¹°æ•°æ®ï¼Œæ•°æ®çš„å®æ—¶åº¦åŠç²¾ç¡®æ€§å½±å“ç€ä½ çš„ç³»ç»Ÿå®ç°, ä¸€èˆ¬ä¸ä¼šåªå¬ä¿¡ä¸€ä¸ªæ•°æ®æºï¼Œä¼šæœ‰ç­–ç•¥è¿›è¡Œæ•°æ®çš„å‡†ç¡®æ€§çš„æ ¡éªŒ        
### é‡åŒ–çš„èµ·ç‚¹å°±æ˜¯æ•°æ®ï¼Œæ²¡æœ‰æ•°æ®ä¸€åˆ‡æ‰¯æ·¡ï¼Œæ•°æ®å³æ˜¯èµ·ç‚¹ä¹Ÿä¼šæ˜¯æœ€ç»ˆçš„ç»ˆç‚¹ï¼Œæ•°æ®çš„å„ç§åˆ†æç»„åˆæ„æˆäº†é‡åŒ–çš„åŸºç¡€ã€‚å¯¹äºè‚¡ç¥¨æ•°æ®ï¼Œå®ƒæ˜¯ç”±è‚¡ç¥¨ä»£ç ï¼Œè‚¡ç¥¨ä»·æ ¼ï¼Œè‚¡ç¥¨æˆäº¤é‡ï¼ŒåŠ ä¸Šæ—¶é—´ç»„æˆäº†ä¸€ä¸ªåºå¤§çš„å››ç»´ç©ºé—´ï¼Œåœ¨è¿™ä¸ªç©ºé—´ä¸­äººä»¬æ ¹æ®æ—¶é—´å‘¨æœŸï¼Œè¡Œä¸šç±»åˆ«ï¼Œå¸‚å€¼å¤§å°ç­‰ç­‰å†å²ç»éªŒï¼Œå®¢è§‚äº‹å®åˆå–èˆç©ºé—´ä¸­å„ä¸ªéƒ¨åˆ†ï¼Œæå–å‹ç¼©è‡ªå·±å…³å¿ƒçš„æ•°æ®ï¼Œä¼ ç»Ÿè‚¡ç¥¨äº¤æ˜“ä¸­ï¼Œç”±äºæ—¶é—´è¿™ä¸ªç»´åº¦çš„å®¢è§‚å­˜åœ¨åŠå‘¨æœŸè¿ç»­ç‰¹æ€§ï¼Œæ—¶é—´è¿™ä¸ªç»´åº¦å¾ˆæœ‰å¯èƒ½è¢«         ä¸€èˆ¬äº¤æ˜“è€…å½“ä½œæœ‹å‹ï¼Œå…·ä½“è¡¨ç°å°±æ˜¯è·Œäº†ä¸å–å‡ºè‚¡ç¥¨ï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´åï¼Œæ¶¨ä¸Šå»å†å–å‡ºï¼Œä½†æ˜¯å®ƒä¸€å®šä¼šæ¶¨ä¸Šå»å—ï¼Œä¹Ÿè®¸ä½ çš„å›ç­”å°±æ˜¯é‚£å°±ç»§ç»­æ‹¿ç€å§ï¼Œ         ä½†å¦‚æœä½ è¦æ˜¯åšè¿‡ç¾è‚¡æœŸæƒäº¤æ˜“ï¼Œæˆ–è€…æœŸè´§ä½ å°±ä¼šå‘ç°å¤šä¸€ä¸ªæ—¶é—´è¿™ä¸ªç»´åº¦æœ‰å¤šä¹ˆçš„å¯æ€•ï¼Œå¯¹æ•´ä¸ªäº¤æ˜“ç³»ç»Ÿå¸¦æ¥å¤šä¹ˆå¤§çš„æ”¹å˜ï¼Œæƒ³æƒ³ç§‘å¹»å°è¯´ä¸‰ä½“ä¸­æœ€åè¢«äºŒç»´åŒ–çš„åœ°çƒå§ï¼Œè¿˜æœ‰å“ªäº›è¿›å…¥4ç»´ç¢ç‰‡ä¸­çš„äººç±»æ€ä¹ˆå½¢å®¹4ç»´çš„ä¸–ç•Œï¼Œåœ¨æ•´ä¸ªè‚¡ç¥¨äº¤æ˜“ä¸­æ‰€æœ‰çš„ç»´åº¦éƒ½ä¸åº”è¯¥æ˜¯æœ‹å‹ï¼Œä½†ä¹Ÿä¸åº”è¯¥æ˜¯æ•Œäººï¼Œé‡åŒ–çš„ç›®æ ‡å°±æ˜¯åœ¨è¿™äº›å¤æ‚çš„ç»´åº¦ä¸­æ ¹æ®ä¸€å®šçš„æ–¹æ³•é™ä½å¤æ‚åº¦éœ€æ‰¾ç‰¹å¾ï¼Œæ€»ç»“è§„å¾‹ï¼ŒæŒ‡å¯¼äº¤æ˜“


æˆ‘å†æ¬¡å¼ºè°ƒï¼Œæ‰€æœ‰å†…å®¹éƒ½ä¸ºåŸåˆ›ï¼Œæˆ‘è¯­è¨€å†™ä½œèƒ½åŠ›å¾ˆä¸€èˆ¬ï¼Œå¦‚æœæœ‰è¯´çš„ä¸æ°å½“çš„åœ°æ–¹è¯·æ‚¨æå‡ºï¼Œæˆ‘å°†æ„Ÿæ¿€ä¸ç¦ï¼

ä¸€èˆ¬ä¼šæŒ‰ç…§ä½ çš„äº¤æ˜“ç³»ç»Ÿæ¥ç»„ç»‡æ•°æ®ï¼Œè¿™é‡Œåªæ˜¯ç®€å•ä¸¾ä¾‹
    # è·å–5å¹´ç¾è‚¡ï¼Œ è¯ºäºšè´¢å¯Œçš„æ•°æ®
    kl_pd = SymbolPd.make_kfold_pd('usNOAH', n_folds=5)
    kl_pd.head()

![Snip20161019_6.png](http://upload-images.jianshu.io/upload_images/3136804-ae1bd7f9027f73b3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

å¦‚ä¸‹è¡¨æ ¼çœ‹åˆ°åˆ†æ—¶æ•°æ®çš„volumeå…¨æ˜¯0å—ï¼Œè¯´æ˜è¿™ä¸ªæ•°æ®æœ‰é—®é¢˜ï¼Œåœ¨ä½ çš„ç³»ç»Ÿä¸­ä¼šæœ‰å¤§é‡ä»£ç å¤„ç†è¿™ç§å¼‚å¸¸çš„ï¼Œfillï¼Œmergeæ•°æ®æ–‡ç« çš„æ ¸å¿ƒä¸æ˜¯è¿™äº›ä¸œè¥¿ï¼Œç®€å•æ è¿‡
   
    # è·å–åˆ†æ—¶æ•°æ®
    kl_pd_minute = SymbolPd.make_kminute_foldpd('usNOAH', n_folds=5, period=1)
    kl_pd_minute.tail()
![Snip20161019_7.png](http://upload-images.jianshu.io/upload_images/3136804-3d77dcb1512b761e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

æ‰€æœ‰æ•°æ®åœ¨ä½ çš„ç³»ç»Ÿä¸­ä¸åº”è¯¥éƒ½æ˜¯å®æ—¶è·å–çš„ï¼Œæœ€å°‘å›å½’æµ‹è¯•æ²¡æœ‰å¿…è¦ï¼Œä¸€èˆ¬ä¼šæœ‰å…¨å±€ç¼“å­˜è®¾ç½®åŠå„ç§ç¼“å­˜ç­–ç•¥ï¼Œ æ¯”å¦‚åŸºæœ¬é¢æ•°æ®å¯¹åº”ä¸€ä¸ªè‚¡ç¥¨ä¸€å¤©åªè·å–ä¸€æ¬¡ç­‰ç­‰ç­–ç•¥

    # åŸºæœ¬é¢ä¿¡æ¯
    SymbolPd.make_pd_info('usNOAH')
    # out
    Avg_Daily_Volume            138362
    EPS_Current_Year              1.76
    EPS_Next_Year                 2.11
    EPS_Next_Quarter                 0
    Dividend_Yield                   0
    Earnings_Share                1.58
    Dividend_Share                   0
    Dividend_Pay_Date         4/9/2013
    52_weekLow                    20.3
    52_weekHigh                  33.55
    50_mv                        26.36
    200_mv                       25.44
    PE_Ratio                     15.68
    PEG_Ratio                     0.71
    PERatio_Real                   NaN
    Price_EPS_Current_Year       14.03
    Price_EPS_Next_Year           11.7
    1yr_Target_Price                29
    Name: NOAH, dtype: object

å¯è§†åŒ–æ•°æ®

**æ•°æ®æ˜¯ä¸€åˆ‡çš„åŸºç¡€ï¼Œå‡†ç¡®æ˜¯é¦–è¦è¦æ±‚ï¼Œæ•°æ®çš„å°è£…ç›®çš„æ˜¯æ»¡è¶³ä¸Šå±‚çš„éœ€æ±‚ï¼Œåœ¨æœ‰éœ€æ±‚çš„å‰æä¸‹è¿›è¡Œå°è£…ï¼Œæ•°æ®çš„å¯è§†åŒ–çš„ç›®çš„æ˜¯èƒ½å¿«é€Ÿçš„è¿›è¡Œåˆ†æï¼Œä¸å› è¯¥æµªè´¹è¿‡å¤šçš„æ—¶é—´åœ¨å¯è§†åŒ–å±‚é¢**

    import MarketDrawer
    MarketDrawer.plot_candle_form_klpd(kl_pd[-252:])


![Snip20161019_10.png](http://upload-images.jianshu.io/upload_images/3136804-19116fa642a7c691.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

  ç»˜å›¾åœ¨æœ‰äº¤äº’éœ€æ±‚çš„æƒ…å†µä¸‹ä¸€èˆ¬ä¼šä½¿ç”¨bokehç­‰é«˜çº§åº“å®Œæˆï¼Œä¸è¦åœ¨å¯è§†åŒ–ä¸Šé€ è½®å­

    MarketDrawer.plot_candle_form_klpd(kl_pd, html_bk=True)
![Snip20161019_11.png](http://upload-images.jianshu.io/upload_images/3136804-6b18d1332a4652f1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

ä¸€èˆ¬çš„å®ç°éœ€è¦æ”¯æŒä»orderä¸­ç»˜åˆ¶ï¼Œorderæ˜¯ä½ çš„äº¤æ˜“ç³»ç»Ÿä¸­å¯¹ä¸€æ¬¡äº¤æ˜“çš„å®šä¹‰ï¼Œå¹¶å¯åŠ å…¥æ›´å¤šçš„æ ‡è®°ï¼Œç›´è§‚æ„Ÿå—ç­–ç•¥å› å­çš„é—®é¢˜åŠæ•ˆæœï¼Œä¿å­˜åœ¨æœ¬åœ°kçº¿å›¾è¿›è¡Œæ·±åº¦å­¦ä¹ åæ–‡ä¼šæ¶‰åŠ

    filter(lambda x: x.startswith('plot'), dir(MarketDrawer))
    # out:
    ['plot_candle_form_klpd',
     'plot_candle_from_order',
     'plot_candle_from_symbol',
     'plot_candle_stick',
     'plot_html_symbol',
     'plot_minute_candle_from_klpd',
     'plot_minute_candle_from_symbol',
     'plot_simple_mul_stock',
     'plot_symbol']

### äººä¸ºçš„ä¸€äº›åˆ†ç±»æ–¹å¼ç¤ºä¾‹ï¼ˆé€‰è¯»ä¸æ–‡ç« ä¸»é¢˜æ— å…³ï¼‰ï¼šç›¸åŒè¡Œä¸šç±»åˆ«çš„è‚¡ç¥¨
    import IndustriesHelper
    r_symbol = 'usSFUN'
    # è¿™é‡Œè·å–äº†æœæˆ¿ç›¸å…³ä¸­æ¦‚è‚¡ç¥¨ç»„æˆpandasä¸‰ç»´é¢æ¿æ•°æ®ï¼ˆè¿™é‡Œæ— æ³•å¯¹pandasç­‰çŸ¥è¯†åšåŸºç¡€è¯´æ˜ï¼Œè¯·é˜…è¯»ç›¸å…³ä¹¦ç±ï¼‰
    pDate, pdata_it = IndustriesHelper.get_industries_panel_from_target(r_symbol, show=True)
   
![output_20_0.png](http://upload-images.jianshu.io/upload_images/3136804-e26a0677140870c5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

æŒ‰ç…§éœ€è¦ï¼Œå¯¹æ•°æ®è¿›è¡Œçš„å„ç§ç»´åº¦è½¬æ¢ï¼Œè§„æ•´æ˜¯é‡åŒ–å·¥ä½œä¸­æœ€æ™®éçš„ä»»åŠ¡

    change_m = pdata_it['netChangeRatio'].dropna(axis=1, how='all')
    change_m = change_m.resample('M').mean().T
    change_m.head(2)
æ›´å¤šå…³äºæ•°æ®è¯·å‚è€ƒï¼š[gitåœ°å€](https://github.com/bbfamily/abu/blob/master/%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96-ABU%E9%87%8F%E5%8C%96%E7%B3%BB%E7%BB%9F.ipynb) 

## 2.ç›¸å…³æ€§ä¸æŒ‡æ ‡

* çš®å°”é€Šç›¸å…³æ€§
* æ–¯çš®å°”æ›¼ç§©ç›¸å…³æ€§
* çš®å°”é€Šsignç›¸å…³æ€§
* æ—¶é—´çº¿æ€§åŠ æƒç›¸å…³æ€§
* atr, obv, macd, rsiï¼Œå¸ƒæ—å¸¦

### ç›¸å…³åœ¨è‚¡ç¥¨é‡åŒ–ä¸­æ˜¯éå¸¸å¸¸ç”¨çš„å·¥å…·ï¼Œæ¯”å¦‚åº•å±‚çš„betaä¸­ä¼šä½¿ç”¨å®ƒè¿›è¡Œä»“ä½æ§åˆ¶ï¼Œç®€å•è¯´ä½ ä¸èƒ½ä¹°å¤ªå¤šèµ°åŠ¿é‚£ä¹ˆç›¸ä¼¼çš„è‚¡ç¥¨ï¼Œé£é™©å¤ªå¤§ï¼ˆbetaç­‰æ¦‚å¿µä¸‹æ–‡ä¼šæœ‰ï¼‰
### atr, obv, macd, rsiæœ€åŸºæœ¬çš„ä¸€äº›æŠ€æœ¯æŒ‡æ ‡
___
å¦‚ä¸‹ç»˜åˆ¶noahä¸€å¹´èµ°åŠ¿æœ€ç›¸ä¼¼çš„10ä¸ªè‚¡ç¥¨ï¼Œä»¥å¤šè¿›ç¨‹çš„æ–¹å¼è¿è¡Œ(ç”±äºé‡åŒ–åˆ†æä¸­å¤§å¤šæ•°éƒ½æ˜¯cpuå¯†é›†å‹è¿ç®—ï¼Œç»“åˆä½¿ç”¨pythonè¿™ä¸ªç¯å¢ƒä¸€èˆ¬ä¼šä½¿ç”¨å¤šè¿›ç¨‹æ–¹å¼ï¼Œrolling=True æ—¶é—´åŠ æƒå³æ—¶é—´çº¦é è¿‘çš„æƒé‡è¶Šå¤§ï¼ŒE_CORE_TYPE_PEARSä½¿ç”¨çš®å°”é€Šç›¸å…³æ€§)

    from SimilarHelper import find_similar_with_cnt, CoreCorrType, pd_list
    net_cg_ret = find_similar_with_cnt('usNOAH', 252, show_cnt=10, how='process', rolling=True,
                          show=True, corr_type=CoreCorrType.E_CORE_TYPE_PEARS.value)


![output_26_2.png](http://upload-images.jianshu.io/upload_images/3136804-4f3325f6c307f4d6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

åœ¨ç›¸å…³æ€§åŸºç¡€ä¸Šé‡åŒ–åº”ç”¨ä¸¾ä¾‹

    import TLineSimilar
    TLineSimilar.calc_similar_top('usNOAH', sc=slice(1, 2), show_cnt=3)
    # out
    usAMG      2.0
    us.IXIC    3.0
    usSINA     4.0
    dtype: float64

å¦‚ä¸ŠæŒ‰ç…§ç­‰æƒé‡çš„æ–¹å¼è®¡ç®—ç›¸å…³æ€§æ’å, æ˜¾ç¤ºå¯¹æ¯”ä¸­ä¼šæŒ‰ç…§look_maxæ–¹å¼å¯¹é½æ•°æ®
   sc=slice é‡‡ç”¨é‚£å‡ ç§ç›¸å…³æ€§åº¦é‡æ–¹å¼
   slice(1, 2)ï¼šsperman ï¼‹ pers sign
   slice(0, 1)ï¼špers ï¼‹  sperman
æœ€åè¿”å›çš„ç»“æœæ˜¯rankçš„ç»“æœï¼Œä»2å¼€å§‹ï¼Œ1æ˜¯symbolè‡ªèº«

###  ç®€å•çš„è¯´å°±æ˜¯ç»¼åˆå‡ ç§ç›¸ä¼¼åº¦å¯¹æ¯”çš„æ–¹å¼ï¼ŒæŒ‰ç…§ç­‰æƒé‡æ–¹å¼åœ¨è¿›è¡Œæ’åºï¼Œå¾—åˆ°ä¸€ä¸ªç»¼åˆç›¸ä¼¼åº¦æ’å
___

    TLineSimilar.calc_similar('usNOAH', 'usSFUN')
    # out
    usNOAH similar rank scoreusSFUN :0.692


![output_32_1.png](http://upload-images.jianshu.io/upload_images/3136804-cf5bc97ef19614db.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


![output_32_2.png](http://upload-images.jianshu.io/upload_images/3136804-a66c0ba65d1ef48d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

è®¡ç®—'usNOAH', 'usSFUN'ä¸åœ¨æ‰€æœ‰è‚¡ç¥¨ä¸­çš„ç›¸ä¼¼åº¦æ°´å¹³ï¼Œä¼šæ¶‰åŠæ‰€æœ‰è‚¡ç¥¨è¿›è¡Œç›¸ä¼¼åº¦è®¡ç®—ï¼Œä½¿ç”¨å®ƒä»¬ä¸¤ä¸ªçš„rankæ’åçš„å°æ•°è¡¨ç°å½¢å¼ä½œä¸ºç»“æœï¼Œè¿™å°±æ˜¯é‡åŒ–çš„æœ€ä¸€èˆ¬åº”ç”¨**ä»¥æ•°å­—çš„æœ€ç»ˆè¡¨ç°å½¢å¼å°†ç»´åº¦åŠå…³ç³»è¿›è¡Œè½¬æ¢é‡åŒ–**

### åœ¨æ­¤åŸºç¡€ä¸Šå®Œæˆä¸€ä¸ªé‡åŒ–åº”ç”¨

**ç›¸å…³ä¸åæ•´æŠ€æœ¯åˆ†æ**
ç›¸å…³ä¸ä¸€å®šåæ•´
åæ•´ä¸ä¸€å®šç›¸å…³
æŠ€æœ¯åˆ†ææ€è·¯ï¼š
ä»æœ€ç›¸å…³çš„top nä¸­å¯»æ‰¾mä¸ªæœ€åæ•´çš„è‚¡ç¥¨ï¼Œç°åœ¨çš„ç­–ç•¥æ˜¯ä»top 100å¤šä¸ªç›¸å…³ç­‰æƒé‡ä¸­é˜€å€¼0.08è®¡ç®—å¯»æ‰¾æœ€åæ•´çš„10ä¸ªè‚¡ç¥¨ï¼Œ10ä¸ªè‚¡ç¥¨æ ‡å‡†åŒ–ååš
diffä¹‹åaxis=1 è½´ä¸Šåšsumï¼Œç±»ä¼¼ç­‰æƒé‡æŠ•ç¥¨æœºåˆ¶æˆå¦‚

        distance_votes
        2015-07-27   -14.724491
        2015-07-28   -12.712066
        2015-07-29   -11.945266
        2015-07-30   -13.801350
        2015-07-31   -13.520431
        2015-08-03   -11.381343
        2015-08-04    -9.486645
        2015-08-05   -11.319338
        2015-08-06    -6.517725
        2015-08-07    -9.103014
        2015-08-10    -5.025694
        ......................

ä¹‹åè®¡ç®—vote diffçš„above stdï¼Œ below stdï¼Œmean, å¯ä»¥æ ¹æ®above stdï¼Œ below stdç­‰ä½œä¸ºäº¤æ˜“ä¿¡å·ï¼Œå½¢æˆç­–ç•¥å› å­çš„åŸºç¡€ç»„æˆéƒ¨ä»½

### ç®€å•è¯´å°±æ˜¯ä»noahç»¼åˆç›¸å…³æ€§æœ€é«˜çš„top100ä¸­å¯»æ‰¾åæ•´åº¦æœ€é«˜çš„10ä¸ªè‚¡ç¥¨ï¼Œç„¶åè¿ç”¨æŠ•ç¥¨æœºåˆ¶ï¼Œå°†å®ƒä»¬åˆä¸ºä¸€ä½“ï¼Œè®¡ç®—æ–¹å·®ä¸æœŸæœ›ï¼Œä¸‹å›¾æœ€åæ˜¾ç¤ºçš„é‚£ä¸ªæœ‰ä¸‰æ¡æ¨ªè¡Œçš„å›¾å°±æ˜¯æœ€ç»ˆç›®çš„ï¼Œä½ å¯ä»¥ç®€å•ç†è§£æˆè´¹äº†åŠå¤©åŠ²å°±æ˜¯ä¸ºäº†å¾—åˆ°è¿™ä¸‰æ¡çº¿ï¼Œå½“è‚¡ä»·è§¦åŠæœ€ä¸Šæ–¹çš„çº¿å°±å–ï¼Œè‚¡ä»·è§¦åŠæœ€ä¸‹æ–¹çš„çº¿å°±å–å‡ºï¼Œåœ¨ä¸­é—´åŒºåŸŸå°±æ˜¯ç›˜æ•´åŒºåŸŸ
___
####  æ›´å¤šå…³äºTLineSimilarè¯·è‡ªè¡Œé˜…è¯»æºä»£ç ï¼Œè¿™é‡Œåªä¸ºé˜æ˜é‡åŒ–æœ€ä¸€èˆ¬æ€§å·¥ä½œæµç¨‹

![output_35_0.png](http://upload-images.jianshu.io/upload_images/3136804-d0f10205be5bef6c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


![output_35_2.png](http://upload-images.jianshu.io/upload_images/3136804-05afb5ff05dee1b2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

**æœ‰ç‚¹çœ‹ä¸æ˜ç™½åœ¨è¯´å•¥äº†å—ï¼Ÿæ²¡å…³ç³»ï¼Œå¯ä»¥å…ˆå‘ä¸‹çœ‹**
### åªè¦æ³¨æ„æœ€åè¿™ä¸ªæœ‰ä¸‰æ¡çº¿åˆ†å‰²å¼€çš„å›¾ï¼Œè¿™å°±æ˜¯æœ€ä¸€èˆ¬çš„é‡åŒ–åˆ†æå¯»æ‰¾ä¹°å…¥å–å‡ºç‚¹çš„ç»“è®ºå›¾, é€šè¿‡æ•°æ®çš„æŠ€æœ¯åˆ†æï¼Œç»Ÿè®¡åˆ†æï¼ŒåŸºæœ¬é¢åˆ†æç›®çš„å¾ˆå¤šæƒ…å†µä¸‹å°±æ˜¯æ‰¾å‡ºè¿™å‡ ä¸ªç‚¹ä½œä¸ºä¿¡å·ï¼Œåœ¨ä½ çš„äº¤æ˜“ç³»ç»Ÿä¸Šå®ç°å¯¹ä¿¡å·çš„å¤„ç†ï¼Œäº¤æ˜“ç³»ç»Ÿå¯èƒ½æ˜¯å›æµ‹ç³»ç»Ÿï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯å®ç›˜ç³»ç»Ÿï¼Œä½†ä»–ä»¬éƒ½éœ€è¦ä¿¡å·

æ›´å¤šç›¸å…³ä¸æŒ‡æ ‡è¯·å‚è€ƒï¼š[gitåœ°å€](https://github.com/bbfamily/abu/blob/master/%E7%9B%B8%E5%85%B3%E6%8C%87%E6%A0%87-ABU%E9%87%8F%E5%8C%96%E7%B3%BB%E7%BB%9F.ipynb) 

## 3. åŸºç¡€äº¤æ˜“

åœ¨æœ‰æ•°æ®å’Œä¿¡å·çš„å‰æä¸‹å°±å¯ä»¥å¼€å§‹åšæœ€ç®€å•çš„äº¤æ˜“å›æµ‹
å›æµ‹äº¤æ˜“çš„åŸºæœ¬ç»„æˆï¼š
### 1. alphaåœ¨å› å­å±‚ä¸‹é¢ï¼Œè´Ÿè´£æ•´ä¸ªäº¤æ˜“å¤§æ¡†æ¶çš„ç›ˆåˆ©ï¼Œè´Ÿè´£ç›¸å¯¹æ¿€è¿›éƒ¨åˆ†ï¼Œä¸€èˆ¬åŒ…æ‹¬æœ€é«˜æ­¢ç›ˆï¼Œæœ€é«˜æ­¢æŸï¼Œæœ€å¤§è·Œå¹…æ­¢æŸï¼Œæœ€å¤§å›æ’¤æ­¢æŸç­‰ç­‰
### 2. å› å­ä½œä¸ºç»„ä»¶æ’å…¥alphaç³»ç»Ÿï¼Œ å› å­å¯ä»¥æ˜¯ç®€å•å› å­åªå‘ç°ä¿¡å·ï¼Œä¹Ÿå¯ä»¥æœ‰è‡ªå·±çš„æ­¢ç›ˆæ­¢æŸç­‰ç­‰è§„åˆ™
### 3. betaç³»ç»Ÿä½œä¸ºé£é™©æ§åˆ¶å±‚åœ¨alphaåº•å±‚ï¼Œæ›´é«˜æƒé™çš„å¯¹äº¤æ˜“è¿›è¡Œé£é™©æ§åˆ¶ï¼Œä¸€èˆ¬æ¯”è¾ƒè°¨æ…çš„åšå‡ºå¹²é¢„ï¼Œå¤§ç›˜é£é™©ï¼Œç»„åˆçš„åˆç†ç›¸å…³æ€§ç­‰ç­‰


### å› å­æ˜¯é‡åŒ–ä¸­å¾ˆé‡è¦çš„æ¦‚å¿µï¼Œå®ƒçš„å¥½åå¯ä»¥è¯´æ˜¯æ•´ä¸ªç³»ç»Ÿèƒ½å¦çœŸæ­£ç›ˆåˆ©çš„å…³é”®ï¼Œalphaå¥½æ¯”æœ‰å®å›¾å¤§å¿—çš„ceoå®ƒçš„ç›®æ ‡è¦æŒ£é’±è¦æŒ£å¥½å¤šå¥½å¤šé’±ï¼Œä½†æ˜¯å®ƒå¯èƒ½åªåœ¨ä¸Šå±‚ç¤¾ä¼šä¸­å¯»æ‰¾çé’±çš„å¤§æ–¹å‘ï¼Œä¸ä¼šæ¶‰åŠç»†èŠ‚ï¼Œbetaå¥½æ¯”ä¿å®ˆçš„cfoå®ƒçš„é¦–è¦ä»»åŠ¡æ˜¯ä¸èƒ½è®©å…¬å¸å®æ‰ï¼Œè¦æ§åˆ¶æœ€å¤§çš„ç³»ç»Ÿé£é™©ï¼Œfactorå°±æ˜¯å…·ä½“çš„ä¸€ä¸ªä¸ªçš„é”€å”®äº†ï¼Œå®ƒä»¬çš„é”€å”®ä¸šç»©ç›´æ¥å°±æ˜¯æ•´ä¸ªå…¬å¸çš„ç›ˆåˆ©æˆ–è€…äºæŸï¼Œè‡ªå·±æœ‰å¯¹äº§å“çš„å®Œæ•´æ§åˆ¶æƒï¼Œä½†alphaæˆ–è€…betaæ—¶ä¸æ—¶çš„è¦ç®¡å®ƒä»¬ï¼Œå¯¹å®ƒä»¬æŒ‡æ‰‹ç”»è„šï¼Œä½†æ˜¯ä»–ä»¬å¿…é¡»å¬ä»ä»–ä¸¤ä¸ªï¼Œä¸€èˆ¬æ¥è¯´cfoçš„æƒé™ä¼šå¤§äºceoä½†ä¹Ÿæœ‰è®¾è®¡æˆcfoï¼Œceoç­‰æƒé™çš„ï¼Œfactorçš„äº§å“åŒ…è£…å°±æ˜¯ç±»ä¼¼ä¸Šé¢TLineSimilarçš„å°è£…ï¼Œå¦‚æœæ„Ÿè§‰æœ‰ç‚¹ç³Šæ¶‚ï¼Œå…ˆæš‚æ—¶è·³è¿‡ï¼Œç°åœ¨ä¸éœ€è¦å…¨éƒ¨ç†è§£
å¦‚ä¸‹ä¸¾ä¾‹ï¼ˆé€‰è¯»ï¼‰ï¼š

		# è®¾ç½®aplhaçš„å‚æ•°
		parameters = {
		                  'stop_win_base_n'    : 3.0,
		                  'stop_loss_base_n'   : 2.0,
		                  'mv_close_atr': 3.0,
		                  'mv_pre_atr'  : 1.5,
		             }

		# æ„å»ºå› å­ 
		# BuyBkFactorClassæ˜¯å‘ä¸Šçªç ´xdå¤©æœ€é«˜è‚¡ä»·ä½œä¸ºä¹°å…¥ä¿¡å·çš„å› å­
		# SellBkFactorClassæ˜¯å‘ä¸‹çªç ´xdå¤©æœ€ä½è‚¡ä»·ä½œä¸ºå–å‡ºä¿¡å·çš„å› å­
		buy_factors = [{'XD': 60, 'class': BuyBkFactorClass, 'draw': True},
		               {'XD': 42, 'class': BuyBkFactorClass, 'draw': True}]

		sell_factors = [{'XD': 60, 'class': SellBkFactorClass, 'draw': True}, 
		                {'XD': 120, 'class': SellBkFactorClass, 'draw': True}]

		target_symbols = ['usNOAH', 'usGOOG']
		# èµ„é‡‘
		cap = CapitalClass(1000000)

		# å¤šä¸ªè‚¡ç¥¨åŠ è½½åŒæ ·çš„nä¸ªå› å­è¿è¡Œå›æµ‹
		results, orders_pd, action_pd, all_fit_symbols = AlphaBSellMvEstimator.do_symbols_with_same_factors(target_symbols, buy_factors, sell_factors, parameters, cap,
		                                                 scoring=Metrics.K_RMULT, show=True)


![output_42_3.png](http://upload-images.jianshu.io/upload_images/3136804-540a84b1aec88366.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


![output_42_4.png](http://upload-images.jianshu.io/upload_images/3136804-1979ba04cdfc2e78.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


![output_42_6.png](http://upload-images.jianshu.io/upload_images/3136804-5a7f65f015e68133.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


![output_42_2.png](http://upload-images.jianshu.io/upload_images/3136804-db17502f100e165d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

ç›´è§‚æ„Ÿè§‰ä¸Šé¢é‚£äº›äº¤æ˜“å›¾ï¼Œé€šè¿‡åˆ†æç”Ÿæ•ˆå› å­ç”Ÿæ•ˆåŸå› ï¼Œ**è°ƒæ•´ä½ çš„å› å­åŠåº•å±‚æ¨¡å‹ï¼Œä½†è¦æ³¨æ„ä¸è¦è¿‡æ‹Ÿåˆ**ï¼Œæ¯ä¸ªå¾®è°ƒéƒ½ä¸åº”è¯¥åªé’ˆå¯¹è¿™æ¬¡äº¤æ˜“æˆ–è€…è¿™ä¸ªè‚¡ç¥¨ï¼Œå½’çº³æ€»ç»“å†™å‡ºè‡ªå·±çš„æœ‰æ•ˆå› å­ï¼Œalphaæ˜¯è¿™é˜¶æ®µçš„ç›®æ ‡

    # è¿”å›çš„äº¤æ˜“æ•°æ®
    orders_pd.head()


![Snip20161019_12.png](http://upload-images.jianshu.io/upload_images/3136804-8cac8da8e087e3ef.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)



    # è¿”å›çš„actionæ•°æ®
    action_pd.head()


  
![Snip20161019_13.png](http://upload-images.jianshu.io/upload_images/3136804-3e90168899ac477b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)



    # è¿”å›çš„èµ„é‡‘æƒ…å†µæ•°æ®
    cap.capital_pd.tail()


![Snip20161019_14.png](http://upload-images.jianshu.io/upload_images/3136804-dbe0719069d56d88.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

### é’ˆå¯¹alphaçš„å‚æ•°åšgrid searchï¼ˆé€‰è¯»ä¸å°é’æœºå…³é”®æ— å…³ï¼‰
**é’ˆå¯¹alphaä¼šæœ‰å¾ˆå¤šå‚æ•°éœ€è¦ï¼Œè®¾ç½®ä¸€èˆ¬çš„åšæ³•æ˜¯ä¼šé¦–å…ˆé’ˆå¯¹alphaçš„å‚æ•°åšgrid searchï¼Œé’ˆå¯¹ç‰¹å®šå› å­ç»„åˆå¯»æ‰¾æœ€ä¼˜å‚æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œé‡åŒ–ä¸­ä¸ç®¡æ˜¯ä½¿ç”¨å‡¸ä¼˜åŒ–è¿˜æ˜¯æ¨¡ç‰¹å¡æ´›åˆ†æè¿˜æ˜¯grid searchéƒ½ä¼šæ¶‰åŠåˆ°å¯»æ‰¾æœ€ä¼˜å‚æ•°ï¼Œæœ€ä¼˜çš„å®šä¹‰ä¸€å®šè¦ä¿è¯ä¸èƒ½è¿‡æ‹Ÿåˆä½ çš„æ•´ä¸ªç³»ç»Ÿï¼Œä¹Ÿå°±æ˜¯è¦åšæ ¹æ®å…·ä½“åº”ç”¨train test split, å¹¶ä¸”éœ€è¦æœ‰ä¸€å¥—åˆç†çš„scoring metrics ä½œä¸ºæ£€éªŒçš„æ ‡å‡†**

	import GridHelper
	from GridSearch import GridSearchCV
	close_atr = np.arange(2.0, 4.0, 0.5)
	pre_atr = np.arange(1.5, 3.0, 0.5)
	win = np.arange(2.0, 4.0, 0.5)
	loss = np.arange(0.5, 1.5, 0.5)
	parameters = {
	                  'stop_win_base_n'    : win,
	                  'stop_loss_base_n'   : loss,
	                  'mv_close_atr': close_atr,
	                  'mv_pre_atr'  : pre_atr,
	                  }

	bk_days = [21, 42]
	sell_bk_factor_grid = {
	              'class': [SellBkFactorClass],
	              'XD'   : bk_days,
	              'draw'  : [True],
	         }
	bk_days2 = [60]
	sell_bk_factor_grid2 = {
	              'class': [SellBkFactorClass],
	              'XD'   : bk_days2,
	              'draw'  : [True],
	         }
	sell_factor_prams = GridHelper.gen_factor_grid(GridHelper.K_GEN_FACTOR_PARM_SELL, *[sell_bk_factor_grid, sell_bk_factor_grid2])


	buy_bk_factor_grid = {
	              'class': [BuyBkFactorClass],
	              'XD'   : [60],
	              'draw'  : [True],
	         }
	buy_bk_factor_grid2 = {
	              'class': [BuyBkFactorClass],
	              'XD'   : [120],
	              'draw'  : [True],
	         }
	buy_factor_prams = GridHelper.gen_factor_grid(GridHelper.K_GEN_FACTOR_PARM_BUY, *[buy_bk_factor_grid, buy_bk_factor_grid2])
	sell_factor_prams, buy_factor_prams, parameters
		ï¼ƒ out
		([[{'XD': 21, 'class': SellBkFactor.SellBkFactorClass, 'draw': True},
		   {'XD': 60, 'class': SellBkFactor.SellBkFactorClass, 'draw': True}],
		  [{'XD': 42, 'class': SellBkFactor.SellBkFactorClass, 'draw': True},
		   {'XD': 60, 'class': SellBkFactor.SellBkFactorClass, 'draw': True}],
		  [{'XD': 21, 'class': SellBkFactor.SellBkFactorClass, 'draw': True}],
		  [{'XD': 42, 'class': SellBkFactor.SellBkFactorClass, 'draw': True}],
		  [{'XD': 60, 'class': SellBkFactor.SellBkFactorClass, 'draw': True}],
		  []],
		 [[{'XD': 60, 'class': BuyBkFactor.BuyBkFactorClass, 'draw': True},
		   {'XD': 120, 'class': BuyBkFactor.BuyBkFactorClass, 'draw': True}],
		  [{'XD': 60, 'class': BuyBkFactor.BuyBkFactorClass, 'draw': True}],
		  [{'XD': 120, 'class': BuyBkFactor.BuyBkFactorClass, 'draw': True}]],
		 {'mv_close_atr': array([ 2. ,  2.5,  3. ,  3.5]),
		  'mv_pre_atr': array([ 1.5,  2. ,  2.5]),
		  'stop_loss_base_n': array([ 0.5,  1. ]),
		  'stop_win_base_n': array([ 2. ,  2.5,  3. ,  3.5])})
   
	# ç†Ÿæ‚‰scikitçš„æœ‹å‹ä¸€å®šå¯¹ä¸‹é¢è¿™ç§å†™æ³•å¾ˆç†Ÿæ‚‰ï¼Œå€Ÿé‰´äº†scikitä¸­å¾ˆå¤šå®ç°çš„å†™æ³•å’Œæ–¹å¼
	svr = AlphaBSellMvEstimator()
	clf = GridSearchCV(svr, parameters, n_jobs=-1, 
	                    scoring=[Metrics.K_QUANT, Metrics.K_RSMM, Metrics.K_SHARP, Metrics.K_RMULT], 
	                    scoring_weight=[0.3, 0.2, 0.2, 0.3],
	                    sell_factor_prams=sell_factor_prams)
	clf.fit_with_buy_factor(cap, test_pd, kl_pd, buy_factor_prams, False)

æ›´å¤šåŸºç¡€äº¤æ˜“ç›¸å…³è¯·è¯·å‚è€ƒï¼š[gitåœ°å€](https://github.com/bbfamily/abu/blob/master/%E5%9F%BA%E7%A1%80%E4%BA%A4%E6%98%93-ABU%E9%87%8F%E5%8C%96%E7%B3%BB%E7%BB%9F.ipynb) 

## 4. ç†è®ºåŸºç¡€
* ç±»ä¼¼ç‰©ç†æœ‰åŸºç¡€ç†è®ºç‰©ç†ï¼ŒåŸºç¡€ç‰©ç†æ„æˆåº”ç”¨ç‰©ç†ç­‰å®ç”¨æŠ€æœ¯
* é‡åŒ–ç³»ç»Ÿä¸­æ„æˆå› å­ç­‰ä¿¡å·è§¦å‘å™¨çš„åŸºç¡€ç†è®ºæŠ€æœ¯åˆ†æå«åšåŸºç¡€æŠ€æœ¯


åŸºäºvwap
***vwap næ—¥æˆäº¤é‡äºnæ—¥æˆäº¤å‡ä»·é™¤æ€»é‡ï¼Œè®¡ç®—å‡ºnæ—¥å‡çº¿ï¼Œä»¥stdä½œä¸ºæ³¢åŠ¨ä¿¡å·ï¼ˆç±»ä¼¼bollï¼‰vwap_mean = (kl_pd.volume * uq_close).sum() / kl_pd.volume.sum()**

    TLineVwap.calc_vwap(kl_pd)
        # out
        vwap(below=19.66000424364312, vwap=24.801009245012615, above=29.94201424638211)

![output_53_0.png](http://upload-images.jianshu.io/upload_images/3136804-6a9d722e202a9f61.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

**è·³ç©º**

è·³ç©ºé˜€å€¼ä¸æ˜¯å–çš„å›ºå®šå€¼: æ ¹æ®æ¯ä¸ªæœˆçš„æ³¢åŠ¨ç‡ä»¥æ—¶é—´åŠ æƒè®¡ç®—è·³ç©ºé˜€å€¼, è¯¦æƒ…çœ‹calc_jumpå…·ä½“å®ç°è®¡ç®—æ¯ä¸ªç¼ºå£çš„å¼ºåº¦ï¼Œè®°å½•å½“å‰è°ƒç©ºé˜€å€¼, æ–¹å‘ç­‰ä¿¡æ¯	
ä»£ç è¯¦æƒ…è¯·è‡ªè¡ŒæŸ¥é˜…æºä»£ç TLineGolden.py å…³é”®ä»£ç å¦‚ä¸‹æ‰€ç¤º:

	def calc_jump(kl_pd, show=True):
	    """
	        è¦ä½¿ç”¨np.abs(klPd['netChangeRatio'])å»è®¡ç®—æ¯ä¸ªæœˆçš„è·³ç©ºé˜€å€¼
	    """
	    kl_pd['abs_netChangeRatio'] = np.abs(kl_pd['netChangeRatio'])
	    xd_mean = kl_pd.resample('21D').mean()
	    net_change_ratio_mean = xd_mean['abs_netChangeRatio']
	    volume_mean = xd_mean['volume']
	    net_change_ratio_min = kl_pd['abs_netChangeRatio'].mean()
	    """
	        last_match_indexåªæ˜¯ä¸ºäº†æé€Ÿ
	    """
	    last_match_index = 0
	    jump_pd = pd.DataFrame()
	    for kl_index in np.arange(0, kl_pd.shape[0]):
	        today = kl_pd.iloc[kl_index]

	        if today.abs_netChangeRatio <= net_change_ratio_min:
	            """
	                åªå¤„ç†æ»¡è¶³æœ€å°å¹…åº¦çš„ï¼Œä¹Ÿå¯æé€Ÿ
	            """
	            continue
	        while net_change_ratio_mean.shape[0] > last_match_index \
	                and kl_pd.index[kl_index] > net_change_ratio_mean.index[last_match_index]:
	            last_match_index += 1

	        if net_change_ratio_mean.shape[0] == last_match_index:
	            """
	                åˆ°æœ€åäº†ï¼Œå€’å›å»ä¸€ä¸ªï¼Œå¯ä¼˜åŒ–ä»£ç 
	            """
	            last_match_index -= 1

	        if volume_mean[last_match_index] > today.volume:
	            """
	                é¦–å…ˆé‡ä¸è¾¾æ ‡çš„å…ˆæ’é™¤äº†
	            """
	            continue

	        jump_threshold = np.abs(net_change_ratio_mean[last_match_index])

	        if today.preClose == 0 or jump_threshold == 0:
	            continue

	        # jump_thresholdè·³å£çš„ç™¾åˆ†æ¯”, jump_difféœ€è¦è°ƒæ§çš„è·ç¦»
	        jump_diff = today.preClose * jump_threshold / 100
	        if today.netChangeRatio > 0 and (today.low - today.preClose) > jump_diff:
	            # if today.netChangeRatio > jump_threshold:
	            """
	                å‘ä¸Šè·³ç©º 1
	            """
	            today['jump'] = 1
	            today['jump_threshold'] = jump_threshold
	            today['jump_diff'] = jump_diff
	            """
	                è®¡ç®—å‡ºè·³ç©ºç¼ºå£å¼ºåº¦
	            """
	            today['jump_power'] = (today.low - today.preClose) / jump_diff
	            jump_pd = jump_pd.append(today)
	        # elif (-today.netChangeRatio) > jump_threshold:
	        elif today.netChangeRatio < 0 and (today.preClose - today.high) > jump_diff:
	            """
	                å‘ä¸‹è·³ç©º ï¼1
	            """
	            today['jump'] = -1
	            today['jump_threshold'] = jump_threshold
	            today['jump_diff'] = jump_diff
	            today['jump_power'] = (today.preClose - today.high) / jump_diff
	            jump_pd = jump_pd.append(today)

	    if show:
	        MarketDrawer.plot_candle_form_klpd(kl_pd, view_indexs=jump_pd.index)
	    return jump_pd

____
    jumps = TLineJump.calc_jump(kl_pd, True)


![output_56_0.png](http://upload-images.jianshu.io/upload_images/3136804-6d5a6a0bfac90de6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

     jumps.filter(['jump', 'jump_diff', 'jump_power', 'jump_threshold', 'netChangeRatio'])


![Snip20161019_15.png](http://upload-images.jianshu.io/upload_images/3136804-d79ceaeee876e9ea.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

#### (é€‰è¯») åº”ç”¨ä¸¾ä¾‹ï¼Œfiterå‡ºé€‚åˆåšä¸ºä¿¡å·è§¦å‘å™¨çš„è·³ç©ºç‚¹
**è·³å£power > 2.0çš„ç»„æˆump arrayæ¥å£ä¸è€ƒè™‘è·³ç©ºæ—¶é—´æƒé‡**

    TLineJump.calc_jump_line(kl_pd)
		# out 
		[jump(date=Timestamp('2015-07-09 00:00:00'), direction=1.0, power=3.9618387589850186, price=21.57),
		 jump(date=Timestamp('2016-01-04 00:00:00'), direction=-1.0, power=2.3439894700780726, price=27.93),
		 jump(date=Timestamp('2016-06-24 00:00:00'), direction=-1.0, power=3.532870325102579, price=24.219999999999999),
		 jump(date=Timestamp('2016-06-29 00:00:00'), direction=1.0, power=4.511374867807322, price=22.989999999999998)]


![output_59_0.png](http://upload-images.jianshu.io/upload_images/3136804-7f315d0304568206.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

**è€ƒè™‘è·³ç©ºæ—¶é—´æƒé‡:ä½¿ç”¨çº¿æ€§æ—¶é—´æƒé‡åˆ†é…swç»™äºˆçš„æƒé‡**

    TLineJump.calc_jump_line_weight(kl_pd, sw=(0.6, 0.4))
		ï¼ƒ out
		[jump(date=Timestamp('2015-07-09 00:00:00'), direction=1.0, power=3.0355718841209267, price=21.57),
		 jump(date=Timestamp('2016-01-04 00:00:00'), direction=-1.0, power=2.0233801747671949, price=27.93),
		 jump(date=Timestamp('2016-05-24 00:00:00'), direction=1.0, power=1.8553875815265513, price=22.260000000000002),
		 jump(date=Timestamp('2016-06-24 00:00:00'), direction=-1.0, power=3.3839700251181362, price=24.219999999999999),
		 jump(date=Timestamp('2016-06-29 00:00:00'), direction=1.0, power=4.3319961454292972, price=22.989999999999998)]


![output_60_0.png](http://upload-images.jianshu.io/upload_images/3136804-0662f652fdf89276.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


**è¶‹åŠ¿**

### æ‹Ÿåˆè¶‹åŠ¿çº¿å¯»æ‰¾æ”¯æ’‘é˜»åŠ›, å¯¹è‚¡ç¥¨â€˜æŠ€æœ¯åˆ†æâ€™å¾ˆç†Ÿæ‚‰çš„æœ‹å‹ğŸ‘¬ä»¬å¯¹ä¸Šå‡è¶‹åŠ¿çº¿ï¼Œä¸‹é™è¶‹åŠ¿çº¿ï¼Œé˜»åŠ›çº¿, æ”¯æ’‘çº¿è¿™äº›æ¦‚å¿µå¾ˆç†Ÿæ‚‰ï¼Œä½†æ˜¯ä»ç†è®ºå‡ºå‘ï¼Œå¾ˆéš¾æœ‰ä¸¤ä¸ªäººç”»å‡ºçš„çº¿æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œå³æ˜¯æ˜¯ä¸€ä¸ªäººä¸åŒçš„æ—¶å€™å»ç”»ä¹Ÿä¼šæœ‰ç²¾åº¦çš„è¯¯å·®ï¼Œä½¿ç”¨æ•°æ®åˆ†æè‡ªå·±ç”»å‡ºè¶‹åŠ¿ä¸é˜»åŠ›æ˜¯å¯¹é‡åŒ–åˆ†æçš„æœ€æ ¹æœ¬è¯ é‡Šï¼Œäººå¯¹æ•°æ®çš„æ•æ„Ÿåº¦ä¸€å®šä¸å¦‚æ­»çš„æœºå™¨ï¼Œå› ä¸º
##äººæ˜¯æœ‰æ„Ÿæƒ…çš„
### ä¹Ÿè®¸ä½ ä¼šç”»å‡ºè‡ªå·±æƒ³è¦çš„è¶‹åŠ¿çº¿é˜»åŠ›çº¿æ¥éª—è‡ªå·±ï¼Œå†åšæŒä¸€ä¸‹é©¬ä¸Šå°±é˜»åŠ›äº†å°±ä¸Šå»äº†ç­‰ç­‰ï¼Œå¿«äº¤ç»™æœºå™¨å§ï¼åˆ«è‡ªå·±ç”»äº†ï¼

    TLineTrend.calc_reg_fit(kl_pd)

	# out
	reg_fit(now=-1.8882674838912408, mean=2.1992989440193578e-15, above=4.6314808634245717, below=-4.6314808634245681, distance_max=14.156795957244121, distance_min=-7.8484906892137687)


![output_64_0.png](http://upload-images.jianshu.io/upload_images/3136804-03506b85c6a85a39.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)



![output_64_1.png](http://upload-images.jianshu.io/upload_images/3136804-725fb763b71f1d49.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


**é»„é‡‘åˆ†å‰²**
ç»¼åˆä¸¤ç§é»„é‡‘åˆ‡å‰²æ–¹å¼ï¼Œæ ¹æ®åº”ç”¨ä½¿ç”¨ maximumï¼Œminimumè¿›è¡Œé€‰æ‹© é‡ç‚¹è¯´ä¸€ä¸‹è¿™ä¸ªï¼Œä¸‹é¢çš„ä¾‹å­éƒ½æ˜¯ä½¿ç”¨è¿™ä¸ªç­–ç•¥ç»„æˆçš„å› å­åšçš„æ‰©å±• é»„é‡‘åˆ†å‰²ä¸€ç§æ˜¯è§†è§‰ä¸Šçš„382ï¼Œ618ï¼Œä¸€ç§å°±æ˜¯ç»Ÿè®¡ä¸Šçš„382ï¼Œ618 ä¹Ÿå°±æ˜¯meanå’Œmediançš„çš„åŒºåˆ« 
å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š

	def find_golden_point_ex(x_org, y_org, show=False):
	    sp382 = stats.scoreatpercentile(y_org, 38.2)
	    sp618 = stats.scoreatpercentile(y_org, 61.8)
	    sp50 = stats.scoreatpercentile(y_org, 50.0)

	    if show:
	        x_org = np.array(x_org)
	        sp382_list = [[x_org.min(), x_org.max()], [sp382, sp382]]
	        sp618_list = [[x_org.min(), x_org.max()], [sp618, sp618]]
	        sp50_list = [[x_org.min(), x_org.max()], [sp50, sp50]]

	        TLineDrawer.plot_xy_with_other_x_y(x_org, y_org, '-', sp382_list, sp50_list, sp618_list)
	    return sp382, sp50, sp618


	def find_golden_point(x_org, y_org, show=False):
	    cs_max = y_org.max()
	    cs_min = y_org.min()

	    sp382 = (cs_max - cs_min) * 0.382 + cs_min
	    sp618 = (cs_max - cs_min) * 0.618 + cs_min
	    sp50 = (cs_max - cs_min) * 0.5 + cs_min
	    if show:
	        x_org = np.array(x_org)
	        sp382_list = [[x_org.min(), x_org.max()], [sp382, sp382]]
	        sp618_list = [[x_org.min(), x_org.max()], [sp618, sp618]]
	        sp50_list = [[x_org.min(), x_org.max()], [sp50, sp50]]

	        TLineDrawer.plot_xy_with_other_x_y(x_org, y_org, '-', sp382_list, sp50_list, sp618_list)
	    return sp382, sp50, sp618


	def calc_golden(kl_pd, show=True, only_be=False):
	    dk = True if kl_pd.columns.tolist().count('close') > 0 else False
	    uq_close = kl_pd.close if dk else kl_pd.price

	    if not hasattr(kl_pd, 'name'):
	        kl_pd.name = 'unknown'

	    g_382, g_500, g_618 = TLineAnalyse.find_golden_point(kl_pd.index, uq_close)
	    if show and not only_be:
	        plt.axes([0.025, 0.025, 0.95, 0.95])
	        plt.plot(uq_close) if dk else plt.plot(uq_close.values)
	        plt.axhline(g_618, color='c')
	        plt.axhline(g_500, color='r')
	        plt.axhline(g_382, color='g')
	        _ = plt.setp(plt.gca().get_xticklabels(), rotation=30)
	        plt.legend([kl_pd.name, 'g618', 'g500', 'g382'])
	        plt.title('mean golden')
	        plt.show()

	    gex_382, gex_500, gex_618 = TLineAnalyse.find_golden_point_ex(kl_pd.index, uq_close)
	    if show and not only_be:
	        plt.axes([0.025, 0.025, 0.95, 0.95])
	        plt.plot(uq_close) if dk else plt.plot(uq_close.values)
	        plt.axhline(gex_618, color='c')
	        plt.axhline(gex_500, color='r')
	        plt.axhline(gex_382, color='g')
	        _ = plt.setp(plt.gca().get_xticklabels(), rotation=30)
	        plt.legend([kl_pd.name, 'gex618', 'gex500', 'gex382'])
	        plt.title('median golden')
	        plt.show()

	    above618 = np.maximum(g_618, gex_618)
	    below618 = np.minimum(g_618, gex_618)
	    above382 = np.maximum(g_382, gex_382)
	    below382 = np.minimum(g_382, gex_382)

	    percents = [0.20, 0.25, 0.30, 0.70, 0.80, 0.90, 0.95]
	    # precents = np.linspace(0.0, 1.0, 0.05)
	    pts_dict = TLineAnalyse.find_percent_point(percents, uq_close)

	    # import pdb
	    # pdb.set_trace()
	    below200 = np.minimum(*pts_dict[0.20])
	    below250 = np.minimum(*pts_dict[0.25])
	    below300 = np.minimum(*pts_dict[0.30])

	    above700 = np.maximum(*pts_dict[0.70])
	    above800 = np.maximum(*pts_dict[0.80])
	    above900 = np.maximum(*pts_dict[0.90])
	    above950 = np.maximum(*pts_dict[0.95])

	    if show:
	        plt.axes([0.025, 0.025, 0.95, 0.95])
	        plt.plot(uq_close) if dk else plt.plot(uq_close.values)

	        plt.axhline(above950, lw=3.5, color='c')
	        plt.axhline(above900, lw=3.0, color='y')
	        plt.axhline(above800, lw=2.5, color='k')
	        plt.axhline(above700, lw=2.5, color='m')

	        plt.axhline(above618, lw=2, color='r')
	        plt.axhline(below618, lw=1.5, color='r')
	        plt.fill_between(kl_pd.index, above618, below618,
	                         alpha=0.1, color="r")

	        '''
	            *************I AM HERE*************
	        '''
	        plt.axhline(above382, lw=1.5, color='g')
	        plt.axhline(below382, lw=2, color='g')
	        plt.fill_between(kl_pd.index, above382, below382,
	                         alpha=0.1, color="g")

	        plt.axhline(below300, lw=2.5, color='k')
	        plt.axhline(below250, lw=3.0, color='y')
	        plt.axhline(below200, lw=3.5, color='c')

	        _ = plt.setp(plt.gca().get_xticklabels(), rotation=30)
	        plt.legend([kl_pd.name, 'above950', 'above900', 'above800', 'above700', 'above618', 'below618',
	                    'above382', 'below382', 'below300', 'below250', 'below200'], bbox_to_anchor=(1.05, 1), loc=2,
	                   borderaxespad=0.)
	        plt.title('between golden')
	        plt.show()

	    return namedtuple('golden', ['g382', 'gex382', 'g500', 'gex500', 'g618',
	                                 'gex618', 'above618', 'below618', 'above382', 'below382',
	                                 'above950', 'above900', 'above800', 'above700', 'below300', 'below250', 'below200'])(
	        g_382, gex_382,
	        g_500, gex_500, g_618, gex_618, above618, below618, above382, below382,
	        above950, above900, above800, above700, below300, below250, below200)

___

    TLineGolden.calc_golden(kl_pd)
		# out
		golden(g382=22.259340000000002, gex382=23.382919999999999, g500=25.134999999999998, gex500=24.379999999999999, g618=28.010660000000001, gex618=25.377079999999999, above618=28.010660000000001, below618=25.377079999999999, above382=23.382919999999999, below382=22.259340000000002, above950=36.101500000000001, above900=34.882999999999996, above800=32.445999999999998, above700=30.009, below300=20.260999999999999, below250=19.0425, below200=17.823999999999998)

å®ƒä»¬ç»„æˆçš„å› å­è”åˆä½¿ç”¨äº†è¿™ä¸¤ç§ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œé…åˆå…¶å®ƒä½ç½®åšæˆå¼¹åŠ›æ­¢ç›ˆæ­¢æŸç­–ç•¥ï¼Œç®€å•çš„è¯´å°±æ˜¯æ¯”å¦‚æˆ‘åœ¨below382å’Œabove382ä¹‹é—´å†æ»¡è¶³ä¸€äº›æ¡ä»¶æ¯”å¦‚ma5 > ma10ä½œä¸ºä¹°å…¥ä¿¡å·, å¦‚æœè‚¡ä»·ä¸‹è·Œåˆ°below200æˆ‘çš„æœ€é«˜æ­¢ç›ˆä¹Ÿéšç€ä¸‹é™ä¸€ä¸ªæ¡£ï¼Œå¦‚æœè‚¡ä»·ä¸Šå‡ä¸€ä¸ªæ¡£ï¼Œæœ€ä½æ­¢æŸä¹Ÿä¸Šå‡ä¸€ä¸ªæ¡£ä½ï¼Œç›´è‡³å‘ä¸Šæˆ–è€…å‘ä¸‹å‡»ç©¿æ­¢æœ€åä¸€ä¸ªç›ˆæ­¢æŸä½

ä»£ç è¯¦æƒ…è¯·è‡ªè¡ŒæŸ¥é˜…æºä»£ç ï¼šTLineGolden.py


![output_67_0.png](http://upload-images.jianshu.io/upload_images/3136804-12478d07d074bf6e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


![output_67_1.png](http://upload-images.jianshu.io/upload_images/3136804-6a20a9064b3a8892.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


![output_67_2.png](http://upload-images.jianshu.io/upload_images/3136804-0ad2c5d6ed16edd5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


æ›´å¤šåŸºç¡€ç†è®ºä¿¡å·è¯·è¯·å‚è€ƒï¼š[gitåœ°å€](https://github.com/bbfamily/abu/blob/master/%E7%90%86%E8%AE%BA%E5%9F%BA%E7%A1%80-ABU%E9%87%8F%E5%8C%96%E7%B3%BB%E7%BB%9F.ipynb)

å•°å•°å—¦å—¦è¯´åˆ°è¿™é‡Œæ‚¨èƒ½å¯èƒ½è¿˜æœ‰å¾ˆå¤šåœ°æ–¹ä¸æ˜ç™½ï¼Œæ²¡å…³ç³»è¿™ç« å†…å®¹æ˜¯é“ºå«ï¼Œè€Œä¸”æ‰‹æ³•ä¸ä¸€å®šéæ˜¯è¿™æ ·ï¼Œæ‚¨åªè¦çŸ¥é“å¦‚ä¸‹å°±å¯ä»¥ç»§ç»­é˜…è¯»ä¸‹ä¸€ç« èŠ‚

### 1. è·å–æ•°æ®ä¸ºæŠ€æœ¯åˆ†æåšåŸºç¡€ï¼ŒæŠ€æœ¯åˆ†ææ˜¯å› å­çš„åŸºç¡€
### 2. å› å­æ˜¯æ•´ä¸ªç³»ç»Ÿèƒ½å¦ç›ˆåˆ©çš„å…³é”®ï¼Œalphaä¸betaï¼‹factoræ˜¯ä¸€ä¸ªç³»ç»Ÿå…³é”®
### 3. æˆ‘ä»¬ä¹‹åçš„ç« èŠ‚ä½¿ç”¨é»„é‡‘åˆ†å‰²çº¿å› å­åšä¸ºdemoï¼Œé»„é‡‘åˆ†å‰²çš„è‚¡ç¥¨æ„ä¹‰

## æ„Ÿè°¢ğŸ™æ‚¨èƒ½æœ‰è€å¿ƒçœ‹åˆ°è¿™é‡Œ
## å¦‚æœæœ‰ä»€ä¹ˆé—®é¢˜å¯ä»¥åŠ é˜¿å¸ƒçš„å¾®ä¿¡ 
## å¾®ä¿¡å·ï¼šaaaabbbuu

![mmexport1475383814280.jpg](http://upload-images.jianshu.io/upload_images/3136804-27b0b66e5bab7a03.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)