# æ‰“å¼€è‚¡ç¥¨é‡åŒ–çš„é»‘ç®±(è‡ªå·±åŠ¨æ‰‹å†™ä¸€ä¸ªå°é’æœº) ç¬¬äºŒç« 

### ä½œè€…ï¼šé˜¿å¸ƒğŸ¶

### æœªç»æœ¬äººå…è®¸ç¦æ­¢è½¬è½½
___
##  éå‡è¡¡èƒœè´Ÿæ”¶ç›Šå¸¦æ¥çš„å¿…ç„¶éå‡è¡¡èƒœè´Ÿæ¯”ä¾‹ï¼Œç›®æ ‡ç”±å› å­çš„èƒ½åŠ›è§£å†³ä¸€éƒ¨åˆ†ï¼Œæ¨¡å¼è¯†åˆ«æå‡å…³é”®çš„ä¸€éƒ¨åˆ†


### éå‡è¡¡èƒœè´Ÿæ”¶ç›Šæ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿæ„æ€ç®€å•è¯´å°±æ˜¯æ¯æ¬¡èµ¢çš„é’±æ¯”æ¯æ¬¡è¾“çš„é’±å¤š

### ä¸ºä»€ä¹ˆè¿™æ˜¯ç©¿è¡Œçš„ç¬¬ä¸€æ­¥å‘¢ï¼Œå› ä¸ºåœ¨è‚¡ç¥¨äº¤æ˜“ä¸­ï¼Œäº¤æ˜“è€…æ°¸è¿œæ˜¯å¤„äºä¸åˆ©çš„åœ°ä½çš„ï¼Œä¸åˆ©çš„æƒ…å†µå°±æ˜¯ä½ éœ€è¦äº¤æ‰‹ç»­è´¹ï¼Œä½ å¯èƒ½ä¼šè¯´é‚£ä¸ªæ²¡æœ‰å¤šå°‘é’±ï¼Œå¦‚æœä½ éšæœºçš„èƒ¡ä¹±ä¹°å–è‚¡ç¥¨ï¼Œåœ¨ä½ æœ‰è¶³å¤Ÿå¤šçš„æœ¬é’±çš„æƒ…å†µä¸‹äº¤æ˜“è¶³å¤Ÿå¤šçš„æ¬¡æ•°ï¼Œæœ€åçš„ç»“æœä¸€å®šæ˜¯ç¬¦åˆæ­£å¤ªåˆ†å¸ƒçš„ï¼Œä½†æ˜¯å¦‚æœä½ æ¯æ¬¡è¦å¤šäº¤ä½ 1%çš„æ‰‹ç»­è´¹ï¼Œæƒ…å†µå°±å¤§ä¸ä¸€æ ·äº†ï¼ŒèµŒåœºè¦æŠ½å¤´ï¼Œä¸æŠ½å¤´çš„èµŒåœºä¸€å®šæœ‰è€åƒ,  è¦åƒäººçš„èµŒåœºåˆæŠ½å¤´åˆå‡ºè€åƒã€‚
____
ä¸‹é¢ç”¨ä»£ç æè¿°è¿™å‡ ç§æƒ…å†µ



	"""
	    è®¾ç½®100ä¸ªèµŒå¾’
	"""
	gamblers = 100

	"""
	    èµŒåœºï¼šç®€å•è®¾å®šæ¯ä¸ªèµŒå¾’ä¸€å…±æœ‰1000000ä¸€å…±æƒ³åœ¨èµŒåœºç©10000000æ¬¡ï¼Œä½ è¦æ˜¯æ²¡é’±äº†ä¹Ÿåˆ«æƒ³ç©äº†
	    win_rate:   è¾“èµ¢çš„æ¦‚ç‡
	    win_once:   æ²¡æ¬¡èµ¢çš„é’±æ•°
	    loss_once:  æ²¡æ¬¡è¾“çš„é’±æ•°
	    commission: æ‰‹ç»­è´¹è¿™é‡Œç®€å•çš„è®¾ç½®äº†0.01 1%
	"""
	def casino(win_rate, win_once=1, loss_once=1, commission=0.01):
	    my_money = 1000000
	    play_cnt = 10000000
	    commission = commission
	    for _ in np.arange(0, play_cnt):
	        w = np.random.binomial(1, win_rate)
	        if w:
	            my_money += win_once
	        else:
	            my_money -= loss_once
	        my_money -= commission
	        if my_money <= 0:
	            break
	    return my_money

	"""
	    ä½¿ç”¨numbaé¢„ç¼–è¯‘åŠ é€Ÿï¼Œå¦åˆ™å¾ˆæ…¢
	"""
	casino_nb = nb.jit(casino)

	"""
	    å¤©å ‚èµŒåœºï¼Œæ²¡æœ‰æŠ½å¤´ï¼Œæ²¡æœ‰è€åƒğŸ˜‡
	    heaven_moneys 100ä¸ª
	    éƒ½å»äº†ä¹‹åç©å›æ¥ä¹‹åçš„ç»“æœ
	"""
	heaven_moneys = [casino_nb(0.5, commission=0) for _ in np.arange(0, gamblers)]

	"""
	    æ²¡æœ‰æŠ½å¤´ï¼Œæœ‰è€åƒğŸ˜«
	"""
	moneys_low = [casino_nb(0.4, commission=0) for _ in np.arange(0, gamblers)]

	"""
	    æœ‰æŠ½å¤´ï¼Œæ²¡æœ‰è€åƒğŸ˜«
	"""
	moneys_commission = [casino_nb(0.5, commission=0.01) for _ in np.arange(0, gamblers)]

	"""
	    æœ‰æŠ½å¤´ï¼Œæœ‰è€åƒğŸ˜«
	"""
	moneys_low_commission = [casino_nb(0.4, commission=0.01) for _ in np.arange(0, gamblers)]

### 1. å¤©å ‚èµŒåœºï¼Œå¤§å®¶éƒ½èƒ½æ´»ä¸‹æ¥ï¼Œæ¯ä¸ªäººäºçš„å’Œèµšçš„æœ€åéƒ½ä¸å¤ªå¤š
        pd.Series(heaven_moneys).hist(bins=30)

  
![output_5_1.png](http://upload-images.jianshu.io/upload_images/3136804-53951547705d6680.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

### 2. æœ‰è€åƒçš„èµŒåœºæ²¡æœ‰äººèƒ½æ´»ä¸‹æ¥ï¼Œé’±éƒ½å½’é›¶äº†
        pd.Series(moneys_low).hist()


![output_7_1.png](http://upload-images.jianshu.io/upload_images/3136804-8e41d1b84b03413a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

### 3. æœ‰æŠ½å¤´çš„èµŒåœºï¼Œçœ‹èµ·æ¥è¿˜ä¸é”™ï¼Œä½†æ˜¯æ²¡æœ‰ä¸€ä¸ªäººèµšé’±çš„éƒ½æ˜¯äºé’±ï¼Œå½“ç©çš„æ¬¡æ•°å†åŠ å¤§ä¸€ä¸ªæ•°é‡çº§ï¼Œæœ€åçš„ç»“æœä¹Ÿä¸€å®šæ˜¯å½’0

      pd.Series(moneys_commission).hist()


![output_9_1.png](http://upload-images.jianshu.io/upload_images/3136804-4bced8785e6e9fb2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

    help(casino)
        Help on function casino in module __main__:
        casino(win_rate, win_once=1, loss_once=1, commission=0.01)

å‡è®¾æˆ‘ä»¬çš„èµŒåœºæ²¡æœ‰è€åƒï¼Œä½†æ˜¯ä¸€å®šä¼šæœ‰æ‰‹ç»­è´¹ï¼Œè¿™æ ·çš„è¯æ³¨æ„ä¸Šé¢çš„èµŒåœºå‡½æ•°ï¼Œæˆ‘ä»¬ä¸èƒ½æœŸå¾…æˆ‘ä»¬æœ‰è€åƒèƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯æ¯”å¦‚è¯´ä½ èƒ½æœ‰å†…éƒ¨æ¶ˆæ¯ï¼ŒæŠŠèƒœç‡æé«˜åˆ°60%æˆ–è€…æ›´é«˜ï¼Œå¦‚æœä½ çœŸçš„æœ‰ï¼Œé‚£ä¹ˆåœŸè±ªæˆ‘ä»¬åšæœ‹å‹å§ğŸ‘»åŠ å¾®ä¿¡ä¸€èµ·å‘è´¢, é‚£å°±åªæœ‰æ¯æ¬¡èµ¢é’±å’Œæ¯æ¬¡è¾“é’±çš„å‚æ•°äº†

    moneys = [casino_nb(0.5, commission=0.01, win_once=1.02, loss_once=0.98) for _ in np.arange(0, gamblers)]

å’Œä¸Šé¢é‚£ä¸ªç›´æ–¹å›¾ğŸ“Šå¯¹æ¯”ä½ èƒ½å‘ç°æ¯ä¸ªäººéƒ½èƒ½èµ¢é’±äº†ï¼Œå½“æˆ‘ä»¬è®¾ç½®äº†æ¯æ¬¡èµ¢å¤šå‡ºé»˜è®¤ä¸¤ä¸ªç‚¹ï¼Œæ¯æ¬¡è¾“å°‘è¾“ä¸¤ä¸ªç‚¹å

    pd.Series(moneys).hist()
![output_14_1.png](http://upload-images.jianshu.io/upload_images/3136804-ea297010f269ee0b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

### ä½†æ˜¯è¿™æ ·çš„è¯é—®é¢˜å°±æ¥äº†ï¼Œä½ å‡­ä»€ä¹ˆèƒ½æ¯æ¬¡å¤šèµ¢ï¼Œæ¯æ¬¡å°‘è¾“ï¼Œå…¶å®å¾ˆç®€å•ï¼Œæ¯æœ¬å…³äºè‚¡ç¥¨çš„ä¹¦ç±éƒ½ä¼šæåˆ°æ­¢æŸçš„ç­–ç•¥

### è¿™äº›ç­–ç•¥çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯è®©èµšé’±è‚¡ç¥¨çš„å¤šèµšé’±ï¼Œè®©äºæŸè‚¡ç¥¨çš„å°‘äºæŸ(ä»–ä»¬çš„æ–‡è¨€æ–‡å†™çš„å°±æ˜¯ä»€ä¹ˆè®©åˆ©æ¶¦å¥”è·‘âœˆï¸)è¿™æ ·çš„ç»“æœå°±æ˜¯äºæŸçš„æ¬¡æ•°æ¯”èµ¢é’±çš„æ¬¡æ•°å¤šï¼Œæ¯æ¬¡èµ¢çš„é’±æ¯”æ¯æ¬¡äºçš„é’±å¤š, ä¹Ÿå°±æ˜¯é«˜æ­¢ç›ˆä½ï¼Œä½æ­¢æŸä½

### æ‰€ä»¥ä½ å‘ç°äº†å—ï¼Œä¸èƒ½å¹³ç™½æ— æ•…çš„æé«˜win_once, å¯¹åº”çš„è¦é™ä½win_rateï¼Œè¿™æ˜¯è‡ªå·±ç»™è‡ªå·±æ‘†åƒçš„èŠ‚å¥å•Šï¼Œæ‰€ä»¥win_rateå¯èƒ½æ˜¯0.45ç”šè‡³æ›´ä½

    moneys = [casino_nb(0.45, commission=0.01, win_once=1.02, loss_once=0.98) for _ in np.arange(0, gamblers)]
    pd.Series(moneys).hist()


![output_17_1.png](http://upload-images.jianshu.io/upload_images/3136804-057297fffc2250e2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

çœ‹åˆ°è¿™ä¸ªå›¾äº†å§ï¼Œæœ€åçš„ç»“æœå°±æ˜¯åˆå›åˆ°äº†æœ‰è¾“æœ‰èµ¢çš„äººï¼Œè¿™å°±æ˜¯æ–‡ç« ä¸»é¢˜æåˆ°çš„:
    
## éå‡è¡¡èƒœè´Ÿæ”¶ç›Šå¸¦æ¥çš„å¿…ç„¶éå‡è¡¡èƒœè´Ÿæ¯”ä¾‹

ä¸Šæ–‡æåˆ°äº†è¦å®ç° **éå‡è¡¡èƒœè´Ÿæ”¶ç›Š**, æ€ä¹ˆæ‰èƒ½åšåˆ°è¿™ä¸ªå‘¢ï¼Œè¯•ç€æŠŠä½ çš„æ­¢ç›ˆä½æé«˜ï¼Œé™ä½ä½ çš„æ­¢æŸä½ï¼Œæ¯”å¦‚è¯´ä½ 10å—é’±ä¹°å…¥ä¸€ä¸ªè‚¡ç¥¨ï¼Œ æ­¢ç›ˆ15æ­¢æŸ9å—å°±é™„å’Œç›®æ ‡ï¼Œè¿™æ ·ä½ èƒ½ç†è§£å¸¦æ¥çš„å¿…ç„¶éå‡è¡¡èƒœè´Ÿæ¯”ä¾‹è¿™ä¸ªæ„æ€äº†å§ã€‚

ä½†æ˜¯è¿™ä¸ªæ­¢ç›ˆæ­¢æŸä½åˆç†å—ï¼Œæ˜¯ä¸æ˜¯åº”è¯¥è°ƒåˆ°14ï¼Œ 8å‘¢æˆ–è€…20ï¼Œ9å‘¢ï¼Œè¿™ä¸ªå°±æ˜¯é‡åŒ–ç³»ç»Ÿæ‰€åšçš„ä¸€èˆ¬ä»»åŠ¡ï¼Œè®°å¾—ä¸Šä¸€ç« è¯´çš„alpha
betaï¼Œfacotrçš„èŒèƒ½å’Œä»»åŠ¡å—ï¼Œä»–ä»¬çš„ä»»åŠ¡å°±æ˜¯åœ¨å› å­çš„ä¸Šå±‚æ§åˆ¶æ­¢ç›ˆæ­¢æŸï¼Œå› å­è‡ªå·±ä¹Ÿä¼šæœ‰è‡ªå·±çš„æ­¢ç›ˆæ­¢æŸä½ã€‚

### é‡åŒ–ç³»ç»Ÿçš„ä¸€å¤§éƒ¨åˆ†åŠŸç”¨å°±æ˜¯ç»´æŒè¿™ä¸ªéå‡è¡¡èƒœè´Ÿæ”¶ç›Š , éå‡è¡¡èƒœè´Ÿæ¯”ä¾‹çš„äº¤æ˜“ç³»ç»Ÿèƒ½æ´»ä¸‹æ¥ï¼Œç”Ÿå­˜æ˜¯ç¬¬ä¸€éœ€æ±‚ï¼Œä»–ä»¬çš„ç›®æ ‡å°±æ˜¯ç”Ÿå­˜
### å…¶å®è¯´çš„ä¸€ç‚¹ä¹Ÿä¸å¤¸å¼ ï¼Œè™½ç„¶alphaæ˜¯æ¿€è¿›çš„ä½†å®ƒçš„æ¿€è¿›åªæ˜¯ä¸ºäº†ä¸ä¿å®ˆçš„betaä¸€èµ·èƒ½æ´»ä¸‹å»ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿè¦æŒ£é’±å°±è¦ä¾é å› å­çš„èƒ½åŠ›ï¼Œå› å­çš„èƒ½åŠ›ä¸»è¦åŠŸç”¨å°±æ˜¯å°½é‡å¹³è¡¡éå‡è¡¡èƒœè´Ÿæ”¶ç›Šä¸éå‡è¡¡èƒœè´Ÿæ¯”ä¾‹éœ€æ‰¾æœ€ä¼˜ç‚¹ï¼Œæ´»ä¸‹æ¥ï¼Œå¹¶ä¸”èƒ½æ´»å¾—æŒºå¥½ã€‚

### å› å­æœ‰å„ç§å„æ ·çš„æ–¹å¼å»å¼ºåŒ–èƒ½åŠ›ï¼Œéœ€æ‰¾æœ€ä¼˜ï¼Œæé«˜èƒœç‡ï¼Œç”±äºè¿™ç¯‡æ–‡ç« çš„é‡ç‚¹ä¸æ˜¯å¦‚ä½•æé«˜å› å­çš„èƒ½åŠ›ï¼Œé‚£ä¸ªä¸»é¢˜å…¶å®ä½ ä¹Ÿå¯ä»¥åœ¨å…¶å®ƒä¸€äº›é‡åŒ–åˆ†ç« ä¸­æ‰¾åˆ°ä¸€äº›æ–¹æ³•ï¼Œä¸‹é¢åªç®€å•ä»‹ç»ä¸€ä¸ªå®ä¾‹ï¼Œå¸Œæœ›ä½ èƒ½ç†è§£, ä¸ç†è§£ä¹Ÿæ²¡å…³ç³»ï¼Œä¸»é¢˜å…¶å®ä»ä¸‹ä¸€ç« æ­£å¼å¼€å§‹ï¼Œé‚£ä¸ªæ‰æ˜¯å°é’æœºçš„å…³é”®ï¼


![Snip20161021_50.png](http://upload-images.jianshu.io/upload_images/3136804-f4b24fa5e323ef24.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

_____

ç›®æ ‡ç”±å› å­çš„èƒ½åŠ›è§£å†³ä¸€éƒ¨åˆ†

### ä¸‹é¢è®²ä¸€ä¸ªå®ä¾‹å¦‚ä½•æ¥æé«˜å› å­çš„èƒ½åŠ›

ä¸Šä¸€ç« ç»“å°¾ç®€å•ä»‹ç»è¿‡é»„é‡‘åˆ†å‰²å› å­ï¼Œè¿™é‡Œä½¿ç”¨å®ƒä½œä¸ºå› å­ï¼Œå†æ¬¡è¯¦ç»†è¯´æ˜ä¸€ä¸‹

	import SymbolPd
	import TLineGolden
	# é€‰æ‹©ä¸€æ®µç¬¦åˆä¹°å…¥æ¡ä»¶çš„ä½ç½®
	kl_pd = SymbolPd.make_kfold_pd('usNOAH')[-82:-40]

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¿™é‡Œé€‰æ‹©äº†[-82:-40] 42å¤©æ•°æ®æ¨¡æ‹Ÿï¼Œä¸”è¿™ä¸€å¤©ç¬¦åˆä¹°å…¥æ¡ä»¶ï¼Œè¿™ä¸ªæ¡ä»¶ä½ å¯ä»¥è®¤ä¸ºæ˜¯
1. åœ¨blow382å’Œabove382ä¹‹é—´
2. ma5 > ma10
3. å¤§ç›˜ã€‚ã€‚ã€‚
4. ã€‚ã€‚ã€‚ã€‚

**æˆ‘å°±ä¸å™è¿°äº†ï¼Œå› å­çš„è§„åˆ™æœ‰å„ç§ï¼Œå˜ç§ä¹Ÿå„å¼‚ï¼Œæ²¡æœ‰å¿…è¦èµ˜è¿°**

å¦‚ä¸‹mc_percent_defaultæ˜¯é»˜è®¤çš„æ­¢ç›ˆæ­¢æŸä½é˜Ÿåˆ—ï¼Œmc_percentæ˜¯ç»è¿‡æœ€ä¼˜è®¡ç®—å‡ºçš„æˆ‘ä»¬ä¼šä½¿ç”¨çš„æ­¢ç›ˆæ­¢æŸä½é˜Ÿåˆ—ï¼Œä¸€ä¼šæˆ‘ä»¬çš„ä¸»è¦ä»»åŠ¡å°±æ˜¯æ¼”ç¤ºæ€ä¹ˆç®—å‡ºæ¥çš„è¿™ä¸ª

	# å„ä¸ªæ­¢ç›ˆæ­¢æŸé»˜è®¤ç‚¹ï¼Œå°±å¦‚ä¸‹å›¾å‘½ä¸­æ‰€ç¤ºæ ‡å‡†çš„200ï¼Œ250ï¼Œ300
	mc_percent_default = [0.200, 0.250, 0.300, 0.382,
	                0.618, 0.700, 0.800, 0.900, 0.950]


	# ä½†æˆ‘ä»¬ä¸ç”¨ä¸Šé¢é‚£ä¸ªé»˜è®¤çš„ï¼Œä¸ºä»€ä¹ˆï¼Œå› ä¸ºé‚£ä¸ªçš„æ•ˆæœæ²¡ä¸‹é¢è¿™ä¸ªå¥½
	mc_percent = [0.21828571428571428, 0.27285714285714285, 0.3274285714285714, 0.382,
	              0.7271428571428571, 0.7817142857142857, 0.8362857142857143, 0.8908571428571428, 0.9454285714285714]

___
    TLineGolden.calc_golden(kl_pd)

![Snip20161023_53.png](http://upload-images.jianshu.io/upload_images/3136804-4104d620e8c7a5f4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

### å¼¹åŠ›æ­¢ç›ˆæ­¢æŸ
ä¸Šä¸€èŠ‚è¯´è¿‡ä½¿ç”¨å¼¹åŠ›æ­¢ç›ˆæ­¢æŸï¼Œå¦‚æœè‚¡ä»·ä¸‹è·Œåˆ°below200æˆ‘çš„æœ€é«˜æ­¢ç›ˆ
ä¹Ÿéšç€ä¸‹é™ä¸€ä¸ªæ¡£ï¼Œå¦‚æœè‚¡ä»·ä¸Šå‡ä¸€ä¸ªæ¡£ï¼Œæœ€ä½æ­¢æŸä¹Ÿä¸Šå‡ä¸€ä¸ªæ¡£ä½ï¼Œç›´è‡³
å‘ä¸Šæˆ–è€…å‘ä¸‹å‡»ç©¿æ­¢æœ€åä¸€ä¸ªç›ˆæ­¢æŸä½ï¼Œè¿™é‡Œç®€å•ç”¨ä»£ç æ¼”ç¤ºä¸€ä¸‹ï¼Œåªæ˜¯æ¼”ç¤ºï¼
å®é™…è¿è¡Œä¼šå¤æ‚å¾ˆå¤šï¼Œå› ä¸ºæœ‰alphaï¼Œbetaï¼Œå› å­æœ¬èº«åŠï¼Œå› å­çš„çˆ¶ç±»ç­‰å„ç§
è¯±å› ï¼Œè¿™é‡Œåªå•çº¯æ¼”ç¤ºå¼¹åŠ›æ­¢ç›ˆæ­¢æŸï¼
    
### å¦‚ä¸‹æ‰€ç¤ºint_demo_trade æ¨¡æ‹Ÿåˆå§‹24.16ä¹°å…¥ï¼Œé€šè¿‡ä¹°å…¥ä»·æ ¼åˆå§‹åŒ–ï¼Œåˆå§‹åŒ–å„ä¸ªæ­¢ç›ˆæ­¢æŸä»·æ ¼ï¼Œæ³¨æ„è¿™é‡Œè¯´çš„æ˜¯ä»·æ ¼ï¼Œæ­¢ç›ˆæ­¢æŸä½å·²ç»å®šä¹‰å¥½äº†å°±æ˜¯mc_percentï¼Œé€šè¿‡mc_percentå’Œä¹°å…¥ä»·ç¡®å®šäº†å„ä¸ªæ­¢ç›ˆæ­¢æŸä»·æ ¼ï¼Œdemo_tradeæ¨¡æ‹Ÿäº¤æ˜“è¿™é‡Œæ¼”ç¤ºäº†å¼¹åŠ›æ­¢ç›ˆæ­¢æŸæ˜¯å¦‚ä½•è¿ä½œçš„ã€‚do_cnt_demo_tradeå°è£…ä¸€æ¬¡äº¤æ˜“


	import WinLossAlloc
	def int_demo_trade():
	    # å‡è®¾ä»¥24.16ä¹°å…¥ï¼Œåˆå§‹åŒ–ï¼Œæ”¯æ’‘é˜»åŠ›ä½
	    bid_price = 24.16
	    
	    # æ³¨æ„è¿™é‡Œåˆ‡åˆ†9ä¸ªä½ï¼ŒæŒ‡å®šæ­¢æŸä½æ˜¯4ä¸ªï¼Œé‚£ä¹ˆæ­¢ç›ˆä½å°±æ˜¯5ä¸ªäº†
	    # ç›®çš„å°±æ˜¯éå‡è¡¡èƒœè´Ÿä¸éå‡è¡¡èƒœè´Ÿæ¯”ä¾‹çš„ç¯å¢ƒå½¢æˆ
	    loss_cnt = 4
	    golden = TLineGolden.calc_mc_golden(kl_pd, mc_percent, loss_cnt)
	    
	    wl = WinLossAlloc.init_golden_w_full(golden, bid_price)
	    # å½¢æˆæ‰€ä»¥é˜»åŠ›æœ‰æ”¯æ’‘ï¼Œå®Œæ•´çš„å¼¹åŠ›æ­¢ç›ˆæ­¢æŸä½åˆ°é½
	    print 'init supports : {}'.format(sorted(wl['supports'])), \
	          'init resistances : {}'.format(sorted(wl['resistances']))
	    print('\n')
	    return wl

	def demo_trade(wl):
	    result_price = 0
	    rs_cnt = 0
	    while wl is not None:
	        rs_cnt += 1
	        supports = wl['supports']
	        resistances = wl['resistances']
	        # 45%æ¦‚ç‡win
	        win = np.random.binomial(1, 0.45)
	        if win:
	            result_price = resistances[-1]
	        else:
	            result_price = supports[0]

	        # å°†è¾“èµ¢åšä¸ºå‚æ•°ï¼Œé‡æ–°è®¡ç®—å‡ºæ­¢ç›ˆæ­¢æŸä½
	        wl = WinLossAlloc.golden_map_wl_grid(win, wl)
	        
	        win_str = 'win' if win else 'loss'
	        
	        print(format('*', '*^108s'))
	        print '{} result is {}'.format(rs_cnt, win_str)
	        if wl:
	            print 'supports : {}'.format(sorted(wl['supports'])), \
	                  'resistances : {}'.format(sorted(wl['resistances']))
	                  
	    
	    bid_price = 24.16
	    print 'result profit is {}'.format((result_price - bid_price))
	    print(format('Â©', '*^108s'))
	    print('\n')
	    
	def do_cnt_demo_trade(t_cnt):
	    while t_cnt > 0:
	        wl = int_demo_trade()
	        demo_trade(wl)
	        t_cnt -= 1

_____


    # æ¨¡æ‹Ÿè¿è¡Œ10æ¬¡äº¤æ˜“ï¼Œé€šè¿‡è¾“å‡ºæ˜¯å¦çœ‹æ‡‚äº†ä»€ä¹ˆæ˜¯å¼¹åŠ›æ­¢ç›ˆæ­¢æŸäº†å‘¢
    # è¯·å°½é‡ç†è§£å¼¹åŠ›æ­¢ç›ˆæ­¢æŸï¼Œä¸ç„¶ç»§ç»­å‘ä¸‹ä¸å®¹æ˜“ç†è§£
    do_cnt_demo_trade(10)
		# out
		init supports : [23.288125714285716, 23.545157142857143, 23.802188571428573, 24.05922] init resistances : [25.684842857142858, 25.941874285714285, 26.198905714285715, 26.455937142857142, 26.712968571428569]
		************************************************************************************************************
		1 result is win
		supports : [23.545157142857143, 23.802188571428573, 24.05922, 25.684842857142858] resistances : [25.941874285714285, 26.198905714285715, 26.455937142857142, 26.712968571428569]
		************************************************************************************************************
		2 result is win
		supports : [24.05922, 25.684842857142858, 25.941874285714285] resistances : [26.198905714285715, 26.455937142857142, 26.712968571428569]
		************************************************************************************************************
		3 result is win
		supports : [25.941874285714285, 26.198905714285715] resistances : [26.455937142857142, 26.712968571428569]
		************************************************************************************************************
		4 result is loss
		supports : [25.941874285714285] resistances : [26.198905714285715, 26.455937142857142]
		************************************************************************************************************
		5 result is win
		supports : [26.198905714285715] resistances : [26.455937142857142]
		************************************************************************************************************
		6 result is loss
		result profit is 2.03890571429
		*****************************************************Â©*****************************************************


		init supports : [23.288125714285716, 23.545157142857143, 23.802188571428573, 24.05922] init resistances : [25.684842857142858, 25.941874285714285, 26.198905714285715, 26.455937142857142, 26.712968571428569]
		************************************************************************************************************
		1 result is loss
		supports : [23.288125714285716, 23.545157142857143, 23.802188571428573] resistances : [24.05922, 25.684842857142858, 25.941874285714285, 26.198905714285715]
		************************************************************************************************************
		2 result is win
		supports : [23.545157142857143, 23.802188571428573, 24.05922] resistances : [25.684842857142858, 25.941874285714285, 26.198905714285715]
		************************************************************************************************************
		3 result is loss
		supports : [23.545157142857143, 23.802188571428573] resistances : [24.05922, 25.684842857142858, 25.941874285714285]
		************************************************************************************************************
		4 result is loss
		supports : [23.545157142857143] resistances : [23.802188571428573, 24.05922]
		************************************************************************************************************
		5 result is win
		supports : [23.802188571428573] resistances : [24.05922]
		************************************************************************************************************
		6 result is loss
		result profit is -0.357811428571
		*****************************************************Â©*****************************************************


		init supports : [23.288125714285716, 23.545157142857143, 23.802188571428573, 24.05922] init resistances : [25.684842857142858, 25.941874285714285, 26.198905714285715, 26.455937142857142, 26.712968571428569]
		************************************************************************************************************
		1 result is loss
		supports : [23.288125714285716, 23.545157142857143, 23.802188571428573] resistances : [24.05922, 25.684842857142858, 25.941874285714285, 26.198905714285715]
		************************************************************************************************************
		2 result is win
		supports : [23.545157142857143, 23.802188571428573, 24.05922] resistances : [25.684842857142858, 25.941874285714285, 26.198905714285715]
		************************************************************************************************************
		3 result is win
		supports : [24.05922, 25.684842857142858] resistances : [25.941874285714285, 26.198905714285715]
		************************************************************************************************************
		4 result is win
		supports : [25.941874285714285] resistances : [26.198905714285715]
		************************************************************************************************************
		5 result is loss
		result profit is 1.78187428571
		*****************************************************Â©*****************************************************


		init supports : [23.288125714285716, 23.545157142857143, 23.802188571428573, 24.05922] init resistances : [25.684842857142858, 25.941874285714285, 26.198905714285715, 26.455937142857142, 26.712968571428569]
		************************************************************************************************************
		1 result is win
		supports : [23.545157142857143, 23.802188571428573, 24.05922, 25.684842857142858] resistances : [25.941874285714285, 26.198905714285715, 26.455937142857142, 26.712968571428569]
		************************************************************************************************************
		2 result is win
		supports : [24.05922, 25.684842857142858, 25.941874285714285] resistances : [26.198905714285715, 26.455937142857142, 26.712968571428569]
		************************************************************************************************************
		3 result is win
		supports : [25.941874285714285, 26.198905714285715] resistances : [26.455937142857142, 26.712968571428569]
		************************************************************************************************************
		4 result is loss
		supports : [25.941874285714285] resistances : [26.198905714285715, 26.455937142857142]
		************************************************************************************************************
		5 result is loss
		result profit is 1.78187428571
		*****************************************************Â©*****************************************************


		init supports : [23.288125714285716, 23.545157142857143, 23.802188571428573, 24.05922] init resistances : [25.684842857142858, 25.941874285714285, 26.198905714285715, 26.455937142857142, 26.712968571428569]
		************************************************************************************************************
		1 result is loss
		supports : [23.288125714285716, 23.545157142857143, 23.802188571428573] resistances : [24.05922, 25.684842857142858, 25.941874285714285, 26.198905714285715]
		************************************************************************************************************
		2 result is loss
		supports : [23.288125714285716, 23.545157142857143] resistances : [23.802188571428573, 24.05922, 25.684842857142858]
		************************************************************************************************************
		3 result is loss
		supports : [23.288125714285716] resistances : [23.545157142857143, 23.802188571428573]
		************************************************************************************************************
		4 result is loss
		result profit is -0.871874285714
		*****************************************************Â©*****************************************************


		init supports : [23.288125714285716, 23.545157142857143, 23.802188571428573, 24.05922] init resistances : [25.684842857142858, 25.941874285714285, 26.198905714285715, 26.455937142857142, 26.712968571428569]
		************************************************************************************************************
		1 result is win
		supports : [23.545157142857143, 23.802188571428573, 24.05922, 25.684842857142858] resistances : [25.941874285714285, 26.198905714285715, 26.455937142857142, 26.712968571428569]
		************************************************************************************************************
		2 result is win
		supports : [24.05922, 25.684842857142858, 25.941874285714285] resistances : [26.198905714285715, 26.455937142857142, 26.712968571428569]
		************************************************************************************************************
		3 result is loss
		supports : [24.05922, 25.684842857142858] resistances : [25.941874285714285, 26.198905714285715, 26.455937142857142]
		************************************************************************************************************
		4 result is loss
		supports : [24.05922] resistances : [25.684842857142858, 25.941874285714285]
		************************************************************************************************************
		5 result is loss
		result profit is -0.10078
		*****************************************************Â©*****************************************************


		init supports : [23.288125714285716, 23.545157142857143, 23.802188571428573, 24.05922] init resistances : [25.684842857142858, 25.941874285714285, 26.198905714285715, 26.455937142857142, 26.712968571428569]
		************************************************************************************************************
		1 result is loss
		supports : [23.288125714285716, 23.545157142857143, 23.802188571428573] resistances : [24.05922, 25.684842857142858, 25.941874285714285, 26.198905714285715]
		************************************************************************************************************
		2 result is win
		supports : [23.545157142857143, 23.802188571428573, 24.05922] resistances : [25.684842857142858, 25.941874285714285, 26.198905714285715]
		************************************************************************************************************
		3 result is win
		supports : [24.05922, 25.684842857142858] resistances : [25.941874285714285, 26.198905714285715]
		************************************************************************************************************
		4 result is win
		supports : [25.941874285714285] resistances : [26.198905714285715]
		************************************************************************************************************
		5 result is win
		result profit is 2.03890571429
		*****************************************************Â©*****************************************************


		init supports : [23.288125714285716, 23.545157142857143, 23.802188571428573, 24.05922] init resistances : [25.684842857142858, 25.941874285714285, 26.198905714285715, 26.455937142857142, 26.712968571428569]
		************************************************************************************************************
		1 result is loss
		supports : [23.288125714285716, 23.545157142857143, 23.802188571428573] resistances : [24.05922, 25.684842857142858, 25.941874285714285, 26.198905714285715]
		************************************************************************************************************
		2 result is loss
		supports : [23.288125714285716, 23.545157142857143] resistances : [23.802188571428573, 24.05922, 25.684842857142858]
		************************************************************************************************************
		3 result is win
		supports : [23.545157142857143, 23.802188571428573] resistances : [24.05922, 25.684842857142858]
		************************************************************************************************************
		4 result is win
		supports : [24.05922] resistances : [25.684842857142858]
		************************************************************************************************************
		5 result is loss
		result profit is -0.10078
		*****************************************************Â©*****************************************************


		init supports : [23.288125714285716, 23.545157142857143, 23.802188571428573, 24.05922] init resistances : [25.684842857142858, 25.941874285714285, 26.198905714285715, 26.455937142857142, 26.712968571428569]
		************************************************************************************************************
		1 result is loss
		supports : [23.288125714285716, 23.545157142857143, 23.802188571428573] resistances : [24.05922, 25.684842857142858, 25.941874285714285, 26.198905714285715]
		************************************************************************************************************
		2 result is win
		supports : [23.545157142857143, 23.802188571428573, 24.05922] resistances : [25.684842857142858, 25.941874285714285, 26.198905714285715]
		************************************************************************************************************
		3 result is loss
		supports : [23.545157142857143, 23.802188571428573] resistances : [24.05922, 25.684842857142858, 25.941874285714285]
		************************************************************************************************************
		4 result is win
		supports : [23.802188571428573, 24.05922] resistances : [25.684842857142858, 25.941874285714285]
		************************************************************************************************************
		5 result is loss
		supports : [23.802188571428573] resistances : [24.05922, 25.684842857142858]
		************************************************************************************************************
		6 result is loss
		result profit is -0.357811428571
		*****************************************************Â©*****************************************************


		init supports : [23.288125714285716, 23.545157142857143, 23.802188571428573, 24.05922] init resistances : [25.684842857142858, 25.941874285714285, 26.198905714285715, 26.455937142857142, 26.712968571428569]
		************************************************************************************************************
		1 result is win
		supports : [23.545157142857143, 23.802188571428573, 24.05922, 25.684842857142858] resistances : [25.941874285714285, 26.198905714285715, 26.455937142857142, 26.712968571428569]
		************************************************************************************************************
		2 result is win
		supports : [24.05922, 25.684842857142858, 25.941874285714285] resistances : [26.198905714285715, 26.455937142857142, 26.712968571428569]
		************************************************************************************************************
		3 result is loss
		supports : [24.05922, 25.684842857142858] resistances : [25.941874285714285, 26.198905714285715, 26.455937142857142]
		************************************************************************************************************
		4 result is win
		supports : [25.684842857142858, 25.941874285714285] resistances : [26.198905714285715, 26.455937142857142]
		************************************************************************************************************
		5 result is loss
		supports : [25.684842857142858] resistances : [25.941874285714285, 26.198905714285715]
		************************************************************************************************************
		6 result is win
		supports : [25.941874285714285] resistances : [26.198905714285715]
		************************************************************************************************************
		7 result is loss
		result profit is 1.78187428571
		*****************************************************Â©*****************************************************

______

**ç›¸ä¿¡ä½ çœ‹äº†ä»£ç å’Œè¾“å‡ºåå°±èƒ½ç†è§£å¼¹åŠ›æ­¢ç›ˆæ­¢æŸä½äº†**



### ä¸Šé¢çš„å®ç°æ˜¯ä½¿ç”¨mc_percent = [0.21828571428571428, 0.27285714285714285, 0.3274285714285714, 0.382, 0.7271428571428571, 0.7817142857142857, 0.8362857142857143, 0.8908571428571428, 0.9454285714285714]æˆ‘ä»¬è¯´æ•ˆæœå¥½ï¼Œæ€ä¹ˆå®šä¹‰æ•ˆæœå¥½å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯è¿è¡Œäº†å¤šæ¬¡ä¹‹åï¼Œç»“æœæœ€å¥½ï¼Œå¬èµ·æ¥æ˜¯ä¸æ˜¯å¥½å‚»ï¼Œä½†æ˜¯å…¶å®ä¸ç®¡æ•°å­¦ä¸Šåå­—å«çš„å¤šå“å”¬äººï¼Œå…¬å¼çœ‹èµ·æ¥æœ‰å¤šå¤æ‚ï¼Œè¿™ç§æ€æƒ³éƒ½æ˜¯åŸºç¡€ï¼Œè’™ç‰¹å¡æ´›å°±æ˜¯è¿™ç§çš„å…¸å‹åº”ç”¨ï¼Œå‡¸ä¼˜åŒ–å…¶å®ä¹Ÿæ˜¯ï¼Œåªä¸è¿‡å®ƒæœ‰è®¡ç®—æ¢¯åº¦çš„æ–¹å¼ï¼ŒåŠ å¿«é€Ÿåº¦ï¼Œä½†æ˜¯è¿™æ ·ä½ å°±å¾ˆæœ‰å¯èƒ½é™·å…¥å±€éƒ¨æœ€ä¼˜ï¼Œä¸€èˆ¬å°±æ˜¯å…ˆå¤§æ¦‚ç»“å‡ºå…¨å±€æœ€ä¼˜ï¼Œç„¶åå¸¦å…¥æ±‚å±€éƒ¨æœ€ä¼˜ã€‚

### æ¥ä¸‹æ¥æˆ‘ä»¬ç”¨é»˜è®¤çš„å°±æ˜¯mc_percent_default = [0.200, 0.250, 0.300, 0.382, 0.618, 0.700, 0.800, 0.900, 0.950]æ‰§è¡Œ20000æ¬¡ï¼Œçœ‹çœ‹ä½¿ç”¨é»˜è®¤çš„å€¼ï¼Œå¤šæ¬¡ä¹‹åè¾“å‡ºçš„ç»“æœï¼

    WinLossAlloc.show_golden_process(0.42, bp=24.3, pf_cnt=200, loop_cnt=20000)


![output_25_2.png](http://upload-images.jianshu.io/upload_images/3136804-9ea124b2edae1f89.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


![output_25_3.png](http://upload-images.jianshu.io/upload_images/3136804-c24931e6dc319df9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


![output_25_4.png](http://upload-images.jianshu.io/upload_images/3136804-f51d4d6d6c31cf44.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

æ‰§è¡Œå¼¹åŠ›ä½æ­¢ç›ˆæ­¢æŸï¼Œ0.42ä½œä¸ºwin_rate ç¬¬2å›¾ä»£è¡¨æ”¶ç›Šæ›²çº¿ï¼Œç¬¬3å›¾ä»£è¡¨åœ¨è¿™äº›æ­¢ç›ˆæ­¢æŸä½ä¸Šçš„æ”¶ç›Šåˆ†å¸ƒ

ä¸Šé¢çš„æ“ä½œ, **é‡åŒ–äº†**mc_percent_default = [0.200, 0.250, 0.300, 0.382, 0.618, 0.700, 0.800, 0.900, 0.950]æ€»å…¬çš„æ”¶ç›Šæ˜¯å¤šå°‘, ä¸Šå‡è¶‹åŠ¿æ˜¯å¦å¹³ç¨³ï¼Œæ”¶ç›Šåˆ†å¸ƒæ˜¯å¦åˆç†ï¼Œè¿™æ ·æˆ‘ä»¬å°±æœ‰äº†ä¸€ä¸ªè¯„åˆ¤mc_percentå‚æ•°çš„é‡åŒ–å‡†åˆ™äº†ï¼Œä¸‹é¢å¼€å§‹å¯»æ‰¾æœ€ä¼˜å‚æ•°

**ä½¿ç”¨è’™ç‰¹å¡æ´›æ–¹æ³•åˆ†ææœ€ä¼˜**

1. è¾“èµ¢æ¯”ä¾‹
2. è¾“èµ¢èµ„é‡‘çš„æ¯”ä¾‹
3. æœ€åæ€»æ”¶ç›Š

å¾ˆæ˜æ˜¾å—ç›Šçš„å…³é”®æ˜¯è¾“èµ¢èµ„é‡‘çš„æ¯”ä¾‹ï¼Œæ‰€ä»¥æ€è·¯æœ€ä¼˜è¾“èµ¢èµ„é‡‘çš„æ¯”ä¾‹

* n_jobs=-1 ä½¿ç”¨å¹¶è¡ŒåŠ é€Ÿ
* æ‰€æœ‰å‡½æ•°åç§°å¸¦nbçš„ä½¿ç”¨numbaåšç¼–è¯‘åŠ é€Ÿå¤„ç†ï¼Œä½†æ•ˆæœä¸€èˆ¬ï¼Œä¸”ä½¿ç”¨numbaä¼šæœ‰ä¸€äº›é™åˆ¶æ¡ä»¶


    filter(lambda func: func.startswith('show_golden'), dir(WinLossAlloc))
		ï¼ƒ out
		['show_golden_mc_nb_process',
		 'show_golden_mc_nb_product_process',
		 'show_golden_mc_process',
		 'show_golden_mc_product_process',
		 'show_golden_nb_process',
		 'show_golden_process',
		 'show_golden_sco_process']


	# éƒ¨åˆ†ä»£ç ï¼Œè¯¦ç»†ä»£ç è¯·æŸ¥è¯¢WinLossAllocæºä»£ç 
	def show_golden_mc_product_process(w_rate, n_jobs=1, symbol=None, max_iter=8, bp=24.3, pf_cnt=200, loop_cnt=20000,
	                                   p_outter_loop=1):
	    """
	    ä½¿ç”¨æ¨¡ç‰¹å¡æ´›æ–¹å¼åˆ†æå¯»æ‰¾æœ€ä¼˜å‚æ•°, æ’åˆ—æœ€åˆæ‰€æœ‰å…ƒç´ 
	    :param n_jobs:
	    :param w_rate:
	    :param symbol:
	    :param max_iter:
	    :param bp:
	    :param pf_cnt:
	    :param loop_cnt:
	    :param p_outter_loop:
	    :return:
	    """

	    """
	        âš ï¸æ§åˆ¶max_iter, 15ä»¥ä¸Šå°±ä¼šæœ‰ä¸Šäº¿ç§æ’åˆ—ç»„åˆäº†
	    """
	    loss_percents = np.linspace(0.0, 0.382, max_iter)
	    win_percents = np.linspace(0.618, 1.0, max_iter)
	    ls = list(itertools.combinations(loss_percents, g_mc_loss_cnt))
	    ws = list(itertools.combinations(win_percents, g_mc_win_cnt))
	    lws = list(itertools.product(ls, ws))

	    # æš‚æ—¶é»˜è®¤8æ ¸cpu,ä¸”æŠŠ0åŠå…¶å®ƒéƒ½å½’ç»“ä¸º-1çš„èŒƒç•´
	    n_jobs = 8 if n_jobs <= 0 else n_jobs
	    process_lws = []
	    if n_jobs > 1:
	        group_adjacent = lambda a, k: zip(*([iter(a)] * k))
	        process_lws = group_adjacent(lws, n_jobs)
	        # å°†å‰©ä¸‹çš„å†æ”¾è¿›å»
	        sf = -(len(lws) % n_jobs)
	        if sf < 0:
	            process_lws.append(lws[sf:])
	    else:
	        process_lws.append(lws)

	    parallel = Parallel(
	        n_jobs=n_jobs, verbose=0, pre_dispatch='2*n_jobs')

	    out = parallel(
	        delayed(_do_mc_product_process)(sub_lws, w_rate, symbol, bp, pf_cnt, loop_cnt,
	                                        p_outter_loop)
	        for sub_lws in process_lws)

	    profits_dict = {}
	    for sub_profits_dict in out:
	        profits_dict.update(sub_profits_dict)

	    return _golden_mc_process_profits(profits_dict)

	def show_golden_mc_process(w_rate, symbol=None, max_iter=5000, bp=24.3, pf_cnt=200, loop_cnt=20000, p_outter_loop=1):
	    """
	    ä½¿ç”¨æ¨¡ç‰¹å¡æ´›æ–¹å¼åˆ†æå¯»æ‰¾æœ€ä¼˜å‚æ•°
	    :param w_rate:
	    :param symbol:
	    :param max_iter:
	    :param bp:
	    :param pf_cnt:
	    :param loop_cnt:
	    :param p_outter_loop:
	    :return:
	    """
	    profits_dict = {}
	    loss_percents = np.linspace(0.0, 0.382, 100)
	    win_percents = np.linspace(0.618, 1.0, 100)
	    golden_tuple = namedtuple('golden', (
	        'below200', 'below250', 'below300', 'below382', 'above618', 'above700', 'above800', 'above900', 'above950'))

	    if symbol is None:
	        kl_pd = SymbolPd.make_kfold_pd('usNOAH')[-82:-40]
	    else:
	        kl_pd = SymbolPd.make_kfold_pd(symbol)

	    for _ in np.arange(max_iter):
	        loss_percent = np.random.choice(loss_percents, g_mc_loss_cnt, replace=False)
	        win_percent = np.random.choice(win_percents, g_mc_win_cnt, replace=False)

	        _golden_mc_process_cmp(kl_pd, loss_percent, win_percent, golden_tuple, profits_dict, w_rate,
	                               bp, pf_cnt, p_outter_loop, loop_cnt, show=False)
	    return _golden_mc_process_profits(profits_dict)


### å‡è®¾èƒ½è¾¾åˆ°0.42çš„èƒœç‡ï¼Œè¿™ä¸ª0.42ä¸ä»£è¡¨æœ€ç»ˆèƒ½è·èƒœçš„æ¯”ä¾‹ï¼Œåªæ˜¯æ¯ä¸€æ¬¡çš„èƒœç‡ï¼Œå¯ä»¥è®¤ä¸ºè¿™ä¸ªå€¼å¯ä»¥æ›´é«˜åˆ°0.5ï¼Œæœ€ç»ˆçš„èƒœç‡ç”±äºé«˜æ­¢ç›ˆä½ï¼Œä½æ­¢æŸä½ä¼šä½äºè¿™ä¸ªå€¼ï¼Œèƒœç‡å…¶å®åœ¨è¿™ä¸ªç­–ç•¥é‡Œæ˜¯ç”±å„ä¸ªæ­¢æŸæ­¢ç›ˆä½å†³å®šçš„ï¼Œè¿™é‡Œæ˜¯å›ºå®šäº†è¿™ä¸ªå‚æ•°ï¼Œç„¶åè¿ç”¨è’™ç‰¹å¡æ´›æ•°å­¦æ–¹æ³•ï¼Œè¿™é‡Œæ˜¯è¿ç”¨åˆ‡ç‰‡å¯èƒ½æ€§ç„¶åæ’åˆ—æœ€åˆæ‰€æœ‰å…ƒç´ ,  é¦–å…ˆå¯è§†åŒ–ç»“æœ, å¯ä»¥æ¸…æ¥šçš„çœ‹å‡ºï¼Œè¦æƒ³æœ€ç»ˆèƒ½èµ¢é’±ï¼Œå…³é”®ç‚¹å°±æ˜¯è¾“èµ¢é’±çš„æ¯”ä¾‹ï¼Œæ¯æ¬¡èµ¢çš„é’±æ¯”è¾“çš„é’±è¶Šå¤šï¼Œæ‰æœ‰å¯èƒ½è¾¾åˆ°æœ€åç›ˆåˆ©ï¼ˆè¶Šå‘å³çº¢è‰²çš„çƒè¶Šå¤šï¼Œå›¾ä¾‹æ˜¾ç¤ºçº¢çƒèƒ½å¤Ÿç›ˆåˆ©ï¼‰
    %time wl_pd = WinLossAlloc.show_golden_mc_product_process(0.42, n_jobs=-1)
    wl_pd
        # out
        CPU times: user 20.4 s, sys: 1.27 s, total: 21.7 s
        Wall time: 11min 44s


![output_33_0.png](http://upload-images.jianshu.io/upload_images/3136804-aafbcf32d877f657.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


![output_33_1.png](http://upload-images.jianshu.io/upload_images/3136804-4be949f2be51f227.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


![Snip20161020_17.png](http://upload-images.jianshu.io/upload_images/3136804-503e0dbc5478da5f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

ç®€å•åˆ†æä¸€ä¸‹ç»“æœ

    wl_pd['sum_moneys'].mean(), wl_pd['wl_rates'].mean(), wl_pd['wl_money_rates'].mean()
        # out
        (-868311.44464704266, 0.36232785714285981, 1.2840789250773326)

    pd.qcut(wl_pd['wl_money_rates'], 100).value_counts().head()
        # out
        (2.262, 2.952]    40
        (1.505, 1.516]    40
        (0.853, 0.868]    40
        (0.917, 0.928]    40
        (0.965, 0.975]    40
        Name: wl_money_rates, dtype: int64

    pd.qcut(wl_pd['sum_moneys'], 10).value_counts()
        # out
		(-36011.0789, 1145831.81]        392
		(-312159.593, -36011.0789]       392
		(-519729.523, -312159.593]       392
		(-696741.476, -519729.523]       392
		(-869575.307, -696741.476]       392
		(-1034834.848, -869575.307]      392
		(-1211503.0155, -1034834.848]    392
		(-1416435.858, -1211503.0155]    392
		(-1706524.702, -1416435.858]     392
		[-2629618.186, -1706524.702]     392
		Name: sum_moneys, dtype: int64
        
è¿˜å¯ä»¥ä½¿ç”¨å‡¸ä¼˜åŒ–æ±‚è§£æœ€ä¼˜æ–¹ç¨‹æ–¹æ³•ï¼šè¯¦ç»†ä»£ç è¯·æŸ¥è¯¢WinLossAlloc 

            bnds = list((0, 0.382) for _ in range(g_mc_loss_cnt)) + list((0.618, 1) for _ in range(g_mc_win_cnt))
            opts = sco.minimize(min_func_st(how), guess_loss_precent + guess_win_precent, method='SLSQP',
                                bounds=bnds, options={'maxiter': max_iter})
                                
            é—®é¢˜æ˜¯å®¹æ˜“é™·å…¥å±€éƒ¨æœ€ä¼˜ï¼Œä¸”ä¸è¦å¤ªç²¾åº¦ï¼Œå¯ä»¥å…ˆæ±‚å…¨å±€æœ€ä¼˜åœ¨å±€éƒ¨
___

	opts, min_func = WinLossAlloc.show_golden_sco_process(0.42, how='sum_money')
	ZLog.info(opts)
	x_array = sorted(opts['x'])
	ZLog.info(x_array)
	min_func(x_array)
        # out
		     fun: 174767.91599998067
		     jac: array([ -3.12758046e+11,   1.14246519e+12,   4.51745309e+12,
		         1.48845611e+12,   6.39651998e+12,   3.96886976e+12,
		         3.69526407e+12,   6.19485965e+12,   7.27680427e+11,
		         0.00000000e+00])
		 message: 'Inequality constraints incompatible'
		    nfev: 11
		     nit: 1
		    njev: 1
		  status: 4
		 success: False
		       x: array([ 0.382     ,  0.32742857,  0.16371429,  0.05457143,  1.        ,
		        0.78171429,  0.89085714,  0.618     ,  0.94542857])
		[0.054571428571428569, 0.1637142857142857, 0.3274285714285714, 0.38200000000000001, 0.61799999999999999, 0.78171428571428569, 0.89085714285714279, 0.9454285714285714, 1.0]

**ä¸‹ä¸€æ­¥ä»mc æœ€ä¼˜ç»“æœé‡Œç­›é€‰, æˆ–è€…ä½¿ç”¨å…¨å±€æœ€ä¼˜brustæ±‚è§£**
        
ä»å›¾åˆ†æï¼Œé™åˆ¶æ¡ä»¶ï¼Œæ‰¾åˆ°nä¸ªè§£

    filter_pd = wl_pd[(wl_pd['wl_money_rates'] > 2.5) & (wl_pd['wl_rates'] > 0.36)]
    filter_pd


![Snip20161020_18.png](http://upload-images.jianshu.io/upload_images/3136804-2ae426439305fe2d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


**å¯è§†åŒ–äººå·¥ä»è¿™nä¸ªé‡ŒæŒ‘é€‰æœ€åˆé€‚çš„**
æŸ±çŠ¶è¦åˆ†å¸ƒå‡åŒ€ï¼Œä¸”è¾¾æˆéå‡è¡¡
è¿™é‡Œé€‰æ‹©ç¬¬å››ä¸ªï¼ˆ992ï¼‰ï¼Œé˜»åŠ›æ”¯æ’‘ä¿æŒéå‡è¡¡ï¼Œä¸”200-500å…¨åˆ†éƒ¨ï¼Œä¸‹é™å‡åŒ€
è¿™é‡Œä¸å†ä¸€ä¸€æè¿°ï¼Œå±•ç°

    WinLossAlloc.check_golden_mc_result(filter_pd, 0.42)

è¿™é‡Œäººå·¥é€‰æ‹©äº†ç¬¬å››ä¸ªç»“æœ

    [0.21828571428571428, 0.27285714285714285, 0.3274285714285714, 0.382, 0.7271428571428571, 0.7817142857142857, 0.8362857142857143, 0.8908571428571428, 0.9454285714285714]
    
ä½œä¸ºå¼¹åŠ›æ­¢ç›ˆæ­¢æŸä½ï¼Œè¿™ä¸ªå°±æ˜¯è¿™é‡Œæ¼”ç¤ºçš„ä¼˜åŒ–å› å­çš„èƒ½åŠ›çš„ä¸€éƒ¨åˆ†ï¼Œè¿˜æœ‰å¾ˆå¤šå› å­èƒ½åŠ›å¾—åˆ°ä¼˜åŒ–çš„åœ°æ–¹ï¼Œæ¯”å¦‚ä½¿ç”¨grid searché€‰æ‹©åˆé€‚çš„å› å­å‚æ•°ç­‰ç­‰ï¼Œè¿™ç¯‡æ–‡ç« çš„é‡ç‚¹ä¸åœ¨å› å­èƒ½åŠ›çš„æå‡ï¼Œå¦‚æœ‰é—®é¢˜ç§ä¸‹æ²Ÿé€šæˆ‘ï¼Œæ¨¡å¼è¯†åˆ«å°†æ˜¯æ–‡ç« çš„é‡ç‚¹

    filter_pd.iloc[3], filter_pd.iloc[3]['keys']
        ï¼ƒ out
		(wl_money_rates                                              2.53375
		 wl_rates                                                     0.3612
		 sum_moneys                                                   710380
		 keys              [0.21828571428571428, 0.27285714285714285, 0.3...
		 Name: 1150, dtype: object,
		 '[0.21828571428571428, 0.27285714285714285, 0.3274285714285714, 0.382, 0.7271428571428571, 0.7817142857142857, 0.8362857142857143, 0.8908571428571428, 0.9454285714285714]')

______

## å› å­çš„èƒ½åŠ›åº¦é‡(é€‰è¯»ä¸æ–‡ç« ä¸»é¢˜å…³ç³»ä¸å¤§ï¼Œä¸‹ä¸€ç« å¼€å§‹æ‰èƒ½è¿›å…¥æ­£é¢˜ğŸ˜“)

**â€˜éå‡è¡¡èƒœè´Ÿæ”¶ç›Šâ€™å¸¦æ¥çš„å¿…ç„¶â€™éå‡è¡¡èƒœè´Ÿæ¯”ä¾‹â€˜ï¼Œç›®æ ‡ç”±â€™å› å­â€˜çš„èƒ½åŠ›è§£å†³ä¸€éƒ¨åˆ†**ï¼Œâ€™æ¨¡å¼è¯†åˆ«â€˜æå‡å…³é”®çš„ä¸€éƒ¨åˆ†
çœ‹åˆ°è¿™é‡Œå¾ˆå¤šæŠ€æœ¯ç»†èŠ‚ä¸æ˜ç™½ä¹Ÿä¸å¿…ç‰¹åˆ«åœ¨æ„ï¼Œå¦‚æœä»¥åä½ èƒ½æ·±å…¥ï¼Œéƒ½ä¸æ˜¯é—®é¢˜ï¼Œç°åœ¨èƒ½æ˜ç™½ä¸Šé¢é»‘ä½“éƒ¨åˆ†çš„æ„æ€å°±å·®ä¸å¤šäº†

å› å­çš„èƒ½åŠ›çš„æå‡å¿…é¡»è¦æœ‰åº¦é‡å·¥å…·åº¦é‡ï¼Œä¸èƒ½ä»…ä»…å‡­ä¸€ä¸¤æ–¹é¢å°±è‚¯å®šæˆ–è€…å¦å®šä»€ä¹ˆï¼Œæ¯”å¦‚æŸä¸ªå› å­åŠ alphaç»„åˆèƒœç‡è¾¾åˆ°90%ï¼Œä½†ä½ å¯èƒ½å‘ç°ï¼Œè¿™ä¸ªå› å­åœ¨ä¸€å¹´çš„å›æµ‹å‘¨æœŸä¸­å°±ç”Ÿæ•ˆäº†å‡ æ¬¡ï¼Œé‚£è¿™ä¸ªå› å­ä¹Ÿä¸ç®—æ˜¯å¥½å› å­ï¼Œæˆ‘çš„åº¦é‡å¦‚ä¸‹æ‰€ç¤º

### ä½¿ç”¨é»„é‡‘åˆ†å‰²å› å­åœ¨ä¸€å¹´å›æµ‹å‘¨æœŸä¸­ï¼Œå¯¹300åªéšæœºè‚¡ç¥¨ç”Ÿæ•ˆçš„åº¦é‡ç»“æœ

	buy_factors = [{'XD': 42, 'class': BuyGoldenFactorClass, 'draw': True}]
	sell_factors = []
	parameters = {
	                  'stop_loss_base_n': 4.0,
	                  'stop_loss_base_n': 2.0,
	                  'mv_close_atr': 3.5,
	                  'mv_pre_atr': 2.0,
	             }
	cap, results, orders_pd, action_pd, all_fit_symbols = FactorUnitTest.random_unit_test(ret_cnt_need=300, 
	    buy_factors=buy_factors, sell_factors=sell_factors, parameters=parameters, show=False)



	rsc = metrics_rsc(*(cap, results, orders_pd, action_pd, all_fit_symbols))
	MetricsManger.make_metrics_from_rsc(rsc, METRICSTYPE.SYSMBOL_R_SCORES_GOLDEN.value)

* æ€»èµ„é‡‘å˜åŒ–æƒ…å†µ
  

![output_54_1.png](http://upload-images.jianshu.io/upload_images/3136804-8ee57de3cc5f2f28.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


![output_54_3.png](http://upload-images.jianshu.io/upload_images/3136804-2f15c3f181149037.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


* è‚¡æœ¬æŠ•å…¥å˜åŒ–æƒ…å†µ


![output_54_2.png](http://upload-images.jianshu.io/upload_images/3136804-a9d0a0d8f8add511.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

* å› å­ç”Ÿæ•ˆé¢‘ç‡


![output_54_4.png](http://upload-images.jianshu.io/upload_images/3136804-1245a3b6a167d884.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

    effect mean day: 1.7756097561
* è§¦å‘å™¨åˆ†å¸ƒæƒ…å†µ

  
![output_54_8.png](http://upload-images.jianshu.io/upload_images/3136804-036c4fc11698dda7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


![output_54_15.png](http://upload-images.jianshu.io/upload_images/3136804-4bb0c9aeeb672d3c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

* å•å­æŒæœ‰å¤©æ•°


![output_54_10.png](http://upload-images.jianshu.io/upload_images/3136804-2ede76aff9a28177.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


	keep days mean: 20.7683881064
	keep days median: buy Date            2.016011e+07
	buy Price           1.900000e+01
	buy Cnt             8.141000e+03
	Sell Price          1.981000e+01
	MaxLoss                     -inf
	key                 3.680000e+02
	profit             -1.447280e+03
	result             -1.000000e+00
	R                  -0.000000e+00
	sharpe              8.675231e-01
	profit_cg          -8.085820e-03
	profit_cg_hunder   -8.085820e-01
	keep_days           1.600000e+01
	dtype: float64

	factor win effect = 0.0266040688576%
	factor loss effect = 0.0704225352113%

* æ¯ç¬”èŠ±è´¹æƒ…å†µ


![output_54_6.png](http://upload-images.jianshu.io/upload_images/3136804-853c8e0ed0712d02.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

	cost info: 
	moments_tuple(mean=160508.95918926984, std=48188.23197058294, skewness=-0.912289200610963, kurtosis=2.5446141847946633)

* top win, top lossï¼Œæœ€å¤§å›æ’¤


![output_54_12.png](http://upload-images.jianshu.io/upload_images/3136804-884440fa060bcdaa.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


æ›´å¤šåº¦é‡ç›¸å…³è¯·å‚è€ƒï¼š[gitåœ°å€](https://github.com/bbfamily/abu/blob/master/%E5%BA%A6%E9%87%8F%E5%B7%A5%E5%85%B7-ABU%E9%87%8F%E5%8C%96%E7%B3%BB%E7%BB%9F.ipynb)

é“ºå«è®²åˆ°è¿™ä¸€ç« å°±å·®ä¸å¤šäº†ï¼Œæˆ‘èƒ½åŠ›æœ‰é™ï¼Œä¸èƒ½é€šè¿‡è¿™ä¹ˆçŸ­çš„ç¯‡å¹…å’Œå†…å®¹æŠŠæ‰€æœ‰äº‹æƒ…è®²æ¸…æ¥šï¼Œå¦‚æœ‰ä¸æ˜ç™½åŠ æˆ‘å¾®ä¿¡ä¸€èµ·æ¢è®¨ï¼Œä»ä¸‹ä¸€ç« å¼€å§‹å°±æ˜¯çœŸæ­£çš„â€˜å°é’æœºâ€™ğŸ”‘ä¹‹è·¯äº†ï¼Œç›´åˆ°è¿™é‡Œä¸ºæ­¢ï¼Œä½ åªè¦çŸ¥é“å¤§æ¦‚èƒ½ç†è§£**éå‡è¡¡èƒœè´Ÿæ”¶ç›Šå¸¦æ¥çš„å¿…ç„¶éå‡è¡¡èƒœè´Ÿæ¯”ä¾‹ï¼Œç›®æ ‡ç”±å› å­çš„èƒ½åŠ›è§£å†³ä¸€éƒ¨åˆ†**å°±å¯ä»¥ï¼Œè‡³äºå…·ä½“çš„æŠ€æœ¯ç»†èŠ‚ï¼Œæš‚æ—¶ä¸ç”¨å¤ªåœ¨æ„ï¼Œå¦‚æœä½ èƒ½æ·±å…¥ä¸‹å»ï¼Œè¿™ä¸€åˆ‡éƒ½ä¸æ˜¯äº‹ğŸ

## æ„Ÿè°¢ğŸ™æ‚¨èƒ½æœ‰è€å¿ƒçœ‹åˆ°è¿™é‡Œ
## å¦‚æœæœ‰ä»€ä¹ˆé—®é¢˜å¯ä»¥åŠ é˜¿å¸ƒçš„å¾®ä¿¡ 
## å¾®ä¿¡å·ï¼šaaaabbbuu


![mmexport1475383814280.jpg](http://upload-images.jianshu.io/upload_images/3136804-5a014495e4d06b72.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)